<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å¤šè¯­è¨€æœ¬åœŸåŒ–ç¿»è¯‘</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:,">
<!-- å¼•å…¥ Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- å¼•å…¥ Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- å¼•å…¥ Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<style>
  /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ï¼Œæ›´ç¬¦åˆæç®€é£æ ¼ */
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  
  body { font-family: 'Inter', sans-serif; }
  
  /* éšè—æœªåŠ è½½å›¾æ ‡æ—¶çš„é—ªçƒ */
  .lucide { vertical-align: middle; }

  /* æ‹–æ‹½æ—¶çš„æ ·å¼ */
  .dragging { opacity: 0.5; transform: scale(0.95); }
</style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:py-10 relative selection:bg-purple-200 selection:text-purple-900">

  <!-- èƒŒæ™¯è£…é¥° (åŠ æ·±äº†ä¸€ç‚¹ç‚¹å…‰æ™•æµ“åº¦ï¼Œä»¥ä¾¿é€è¿‡æ¯›ç»ç’ƒçœ‹å¾—æ›´æ¸…æ¥š) -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
    <div class="absolute top-[-10%] left-[-10%] w-[40rem] h-[40rem] bg-purple-300/40 rounded-full blur-[100px]"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[30rem] h-[30rem] bg-blue-300/40 rounded-full blur-[100px]"></div>
    <div class="absolute top-[20%] right-[20%] w-[20rem] h-[20rem] bg-white/60 rounded-full blur-[80px]"></div>
  </div>

  <!-- ä¸»å®¹å™¨ï¼šäºšå…‹åŠ›æ¯›ç»ç’ƒæ•ˆæœ (Acrylic Glass) -->
  <!-- æ”¹åŠ¨ï¼šbg-white/30 (æ›´é«˜é€), backdrop-blur-2xl (å¼ºæ¨¡ç³Š) -->
  <div class="container mx-auto max-w-6xl">
    <div class="bg-white/30 backdrop-blur-2xl rounded-[40px] border border-white/40 shadow-[0_8px_30px_rgba(0,0,0,0.04)] p-8 md:p-12 relative overflow-hidden ring-1 ring-white/30">
      
      <!-- é¡¶éƒ¨è£…é¥°æ¡ -->
      <div class="absolute top-0 left-1/2 -translate-x-1/2 w-24 h-1.5 bg-white/40 rounded-b-xl backdrop-blur-md"></div>

      <!-- æ ‡é¢˜åŒº -->
      <div class="text-center mb-10">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/60 shadow-sm border border-white/50 mb-4 backdrop-blur-md">
          <i data-lucide="languages" class="w-8 h-8 text-purple-600"></i>
        </div>
        <h1 class="text-3xl font-bold text-slate-800 tracking-tight mb-2">å¤šè¯­è¨€æœ¬åœŸåŒ–ç¿»è¯‘</h1>
        <p class="text-slate-600 font-medium bg-white/40 inline-block px-4 py-1 rounded-full backdrop-blur-md text-sm border border-white/30">
          è¾“å…¥è¯­è¨€ï¼š<span class="text-slate-800 font-bold">è‹±æ–‡</span>
        </p>
      </div>

      <!-- è®¾ç½®æ  (æ‰¹å¤§å° & API Key) -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6 mb-8">
        <div class="md:col-span-3">
          <label for="batchSize" class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">æ‰¹å¤§å°</label>
          <div class="relative group">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i data-lucide="layers" class="w-4 h-4 text-slate-500 group-focus-within:text-purple-600 transition-colors"></i>
            </div>
            <!-- è¾“å…¥æ¡†æ”¹ä¸º bg-white/40 ä»¥é€‚åº”æ›´é€çš„èƒŒæ™¯ -->
            <input type="number" id="batchSize" value="50" min="1" max="500" 
              class="w-full pl-10 pr-4 py-3 bg-white/40 border border-transparent rounded-2xl text-slate-700 placeholder-slate-500 hover:bg-white/60 focus:bg-white/80 focus:border-purple-200 focus:ring-4 focus:ring-purple-100/50 transition-all outline-none shadow-sm font-medium backdrop-blur-sm">
          </div>
        </div>

        <div class="md:col-span-9">
          <label for="userApiKey" class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">API Key</label>
          <div class="relative group">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i data-lucide="key" class="w-4 h-4 text-slate-500 group-focus-within:text-purple-600 transition-colors"></i>
            </div>
            <input type="password" id="userApiKey" placeholder="sk-..." 
              class="w-full pl-10 pr-4 py-3 bg-white/40 border border-transparent rounded-2xl text-slate-700 placeholder-slate-500 hover:bg-white/60 focus:bg-white/80 focus:border-purple-200 focus:ring-4 focus:ring-purple-100/50 transition-all outline-none shadow-sm font-mono text-sm backdrop-blur-sm">
          </div>
        </div>
      </div>
      
      <!-- è¾“å…¥æºæ–‡æœ¬ -->
      <div class="mb-8">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">å¾…ç¿»è¯‘è¯æ±‡ (æ¯è¡Œä¸€ä¸ª)</label>
        <div class="relative">
          <textarea id="sourceText" placeholder="ç¤ºä¾‹ï¼š&#10;AI Stem Splitter&#10;Free Key and BPM Finder"
            class="w-full p-5 min-h-[160px] bg-white/40 border border-transparent rounded-3xl text-slate-700 placeholder-slate-500 hover:bg-white/60 focus:bg-white/80 focus:border-purple-200 focus:ring-4 focus:ring-purple-100/50 transition-all outline-none shadow-sm resize-y font-sans text-sm leading-relaxed backdrop-blur-sm"></textarea>
          <div class="absolute bottom-4 right-4 pointer-events-none">
            <i data-lucide="pen-line" class="w-5 h-5 text-slate-400"></i>
          </div>
        </div>
      </div>

      <!-- ç¤ºä¾‹ & é¢„è®¾åŒºåŸŸ (ä¸¤æ å¸ƒå±€) -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- å·¦ä¾§ï¼šæœ€ä½³ç¤ºä¾‹ -->
        <div class="bg-white/30 rounded-3xl p-6 border border-white/40 shadow-sm backdrop-blur-md hover:bg-white/50 transition-colors ring-1 ring-white/20">
          <div class="flex justify-between items-center mb-4">
            <label class="text-xs font-bold text-slate-600 uppercase tracking-wider flex items-center gap-2">
              <i data-lucide="sparkles" class="w-4 h-4 text-yellow-500"></i> æœ€ä½³ç¤ºä¾‹ (Few-shot)
            </label>
            <select id="examplePreset" class="text-xs bg-white/50 border-none rounded-full px-3 py-1 text-slate-700 font-medium shadow-sm cursor-pointer hover:bg-white/80 focus:ring-2 focus:ring-purple-200 outline-none backdrop-blur-sm">
              <option value="">ğŸ“‹ åŠ è½½é¢„è®¾...</option>
              <option value="music">ğŸµ éŸ³ä¹ç«™</option>
              <option value="coloring">ğŸ¨ å¡«è‰²é¡µ</option>
            </select>
          </div>
          <textarea id="bestExamples" placeholder="ç¤ºä¾‹æ ¼å¼ï¼š&#10;AI Stem Splitter => AI éŸ³è½¨åˆ†ç¦»å™¨"
            class="w-full p-4 min-h-[120px] bg-white/40 border border-transparent rounded-2xl text-slate-700 placeholder-slate-500 focus:bg-white/80 focus:ring-2 focus:ring-purple-100/50 transition-all outline-none text-sm mb-3 resize-none hover:bg-white/60 backdrop-blur-sm"></textarea>
          <button id="previewExampleBtn" class="w-full py-2.5 rounded-xl bg-white/60 text-slate-700 font-medium text-sm shadow-sm border border-white/50 hover:bg-purple-50/80 hover:text-purple-600 hover:border-purple-100 transition-all flex items-center justify-center gap-2 group backdrop-blur-sm">
            <i data-lucide="eye" class="w-4 h-4 text-slate-500 group-hover:text-purple-500"></i> é¢„è§ˆç¤ºä¾‹è¡¨æ ¼
          </button>
        </div>

        <!-- å³ä¾§ï¼šè‡ªå®šä¹‰æç¤ºè¯ -->
        <div class="bg-white/30 rounded-3xl p-6 border border-white/40 shadow-sm backdrop-blur-md hover:bg-white/50 transition-colors ring-1 ring-white/20">
          <div class="flex justify-between items-center mb-4">
             <label class="text-xs font-bold text-slate-600 uppercase tracking-wider flex items-center gap-2">
              <i data-lucide="message-square-dashed" class="w-4 h-4 text-blue-500"></i> ç³»ç»Ÿæç¤ºè¯ (System Prompt)
            </label>
            <select id="presetPrompt" class="text-xs bg-white/50 border-none rounded-full px-3 py-1 text-slate-700 font-medium shadow-sm cursor-pointer hover:bg-white/80 focus:ring-2 focus:ring-purple-200 outline-none backdrop-blur-sm">
              <option value="">ğŸ¤– åŠ è½½é¢„è®¾...</option>
              <option value="music">ğŸµ éŸ³ä¹ç«™é£æ ¼</option>
              <option value="coloring">ğŸ¨ å¡«è‰²é¡µé£æ ¼</option>
            </select>
          </div>
          <textarea id="customPrompt" placeholder="ä¾‹å¦‚ï¼šè¯·ä¿æŒä¸“ä¸šè¯­æ°”ï¼Œä¼˜å…ˆä½¿ç”¨çŸ­å¥..."
            class="w-full p-4 min-h-[120px] bg-white/40 border border-transparent rounded-2xl text-slate-700 placeholder-slate-500 focus:bg-white/80 focus:ring-2 focus:ring-purple-100/50 transition-all outline-none text-sm mb-3 resize-none hover:bg-white/60 backdrop-blur-sm"></textarea>
          <div class="text-[10px] text-slate-500 px-1 text-center">æ­¤æç¤ºè¯å°†ä½œä¸ºç³»ç»ŸæŒ‡ä»¤æŒ‡å¯¼ AI çš„ç¿»è¯‘é£æ ¼ä¸ç”¨è¯è§„èŒƒã€‚</div>
        </div>
      </div>

      <!-- æ‹–æ‹½æ’åº -->
      <div class="mb-10">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 ml-1 text-center">æ‹–æ‹½è°ƒæ•´è¾“å‡ºé¡ºåº</label>
        <ul id="headerList" class="flex flex-wrap justify-center gap-3">
          <li draggable="true" data-code="zh" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
            <span class="w-2 h-2 rounded-full bg-red-400"></span> zh
          </li>
          <li draggable="true" data-code="ja" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
            <span class="w-2 h-2 rounded-full bg-pink-400"></span> ja
          </li>
          <li draggable="true" data-code="de" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
            <span class="w-2 h-2 rounded-full bg-yellow-400"></span> de
          </li>
          <li draggable="true" data-code="pt" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
            <span class="w-2 h-2 rounded-full bg-green-400"></span> pt
          </li>
          <li draggable="true" data-code="es" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
            <span class="w-2 h-2 rounded-full bg-orange-400"></span> es
          </li>
          <li draggable="true" data-code="fr" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
            <span class="w-2 h-2 rounded-full bg-blue-400"></span> fr
          </li>
          <li draggable="true" data-code="ko" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
            <span class="w-2 h-2 rounded-full bg-teal-400"></span> ko
          </li>
          <li draggable="true" data-code="tw" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
             <span class="w-2 h-2 rounded-full bg-red-300"></span> tw
          </li>
          <li draggable="true" data-code="vi" class="cursor-grab active:cursor-grabbing bg-white/60 text-slate-700 px-5 py-2.5 rounded-full border border-white/50 shadow-sm text-sm font-semibold hover:bg-white hover:border-purple-200 hover:text-purple-600 hover:shadow-md transition-all select-none flex items-center gap-2 backdrop-blur-sm">
             <span class="w-2 h-2 rounded-full bg-red-600"></span> vi
          </li>
        </ul>
      </div>

      <!-- æ“ä½œæŒ‰é’®åŒº -->
      <div class="flex flex-col md:flex-row items-center gap-4 pt-6 border-t border-white/30">
        <button id="runBtn" class="w-full md:w-auto flex-1 py-4 px-8 rounded-2xl bg-slate-800/90 text-white font-bold text-lg shadow-xl shadow-slate-400/30 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-3 backdrop-blur-md">
          <i data-lucide="rocket" class="w-5 h-5"></i> ç¿»è¯‘å¹¶ç”Ÿæˆè¡¨æ ¼
        </button>
        
        <div class="flex gap-3 w-full md:w-auto">
          <button id="copyBtn" class="flex-1 md:flex-none py-4 px-6 rounded-2xl bg-white/60 text-purple-700 font-semibold border border-purple-100 shadow-sm hover:bg-white/80 hover:shadow-md transition-all flex items-center justify-center gap-2 backdrop-blur-sm">
            <i data-lucide="clipboard-check" class="w-5 h-5"></i> å¤åˆ¶ TSV
          </button>
          <button id="dlBtn" class="flex-1 md:flex-none py-4 px-6 rounded-2xl bg-white/60 text-slate-700 font-semibold border border-slate-100 shadow-sm hover:bg-white/80 hover:shadow-md transition-all flex items-center justify-center gap-2 backdrop-blur-sm">
            <i data-lucide="download" class="w-5 h-5"></i> ä¸‹è½½ TSV
          </button>
        </div>
      </div>

      <!-- çŠ¶æ€æ¡ -->
      <div id="status" class="mt-6 p-4 rounded-xl bg-white/40 border border-white/40 text-slate-600 text-sm font-medium flex items-center gap-3 backdrop-blur-md shadow-sm">
        <span class="w-1.5 h-1.5 rounded-full bg-slate-400"></span>
        å¾…ç¿»è¯‘
      </div>

    </div>

    <!-- ç»“æœå±•ç¤ºåŒº (ç‹¬ç«‹å¡ç‰‡ï¼Œä¹Ÿæ”¹ä¸ºäºšå…‹åŠ›é£æ ¼) -->
    <div class="result-section mt-8 bg-white/30 backdrop-blur-2xl rounded-[40px] border border-white/40 shadow-[0_8px_30px_rgba(0,0,0,0.04)] p-8 md:p-12 relative hidden ring-1 ring-white/30" id="resultContainer">
      <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-3">
        <div class="p-2 bg-green-100/80 rounded-lg text-green-700 backdrop-blur-sm">
          <i data-lucide="table-2" class="w-5 h-5"></i>
        </div>
        ç¿»è¯‘ç»“æœ
      </h2>
      
      <div class="table-wrap overflow-x-auto rounded-2xl border border-white/40 shadow-sm bg-white/20 backdrop-blur-sm" id="tableWrap" style="display:none;">
        <table id="resultTable" class="w-full text-left border-collapse">
          <thead><tr class="bg-white/40 border-b border-white/30 text-xs uppercase text-slate-600 font-bold tracking-wider backdrop-blur-sm"></tr></thead>
          <tbody class="divide-y divide-white/30 text-sm text-slate-700"></tbody>
        </table>
      </div>
      <div class="text-xs text-slate-500 mt-4 flex items-center gap-2 font-medium">
        <i data-lucide="info" class="w-3 h-3"></i>
        æ³¨ï¼šè¡¨æ ¼ä¸­ç©ºç™½å•å…ƒæ ¼ä¼šæ ‡çº¢ï¼Œè¡¨ç¤ºå¯èƒ½æ¼è¯‘ï¼›HTML æ ‡ç­¾ä¸å ä½ç¬¦åŸæ ·ä¿ç•™ã€‚
      </div>
    </div>
  </div>

  <!-- å…¨å±€ Toast é€šçŸ¥ -->
  <div class="toast fixed top-6 right-6 bg-slate-800/90 text-white px-6 py-3 rounded-xl shadow-2xl text-sm font-medium flex items-center gap-3 opacity-0 translate-y-[-20px] transition-all duration-300 z-[100] backdrop-blur-md" id="toast">
    <i data-lucide="check-circle-2" class="w-4 h-4 text-green-400"></i>
    <span id="toastMsg">å·²å¤åˆ¶</span>
  </div>

  <!-- ç¤ºä¾‹é¢„è§ˆæ¨¡æ€æ¡† (Glass Style) -->
  <div id="examplePreviewModal" class="fixed inset-0 z-[1000] hidden items-center justify-center bg-slate-900/30 backdrop-blur-md p-4">
   <div class="bg-white/80 backdrop-blur-2xl rounded-3xl w-full max-w-4xl max-h-[80vh] flex flex-col shadow-2xl border border-white/50">
      <div class="flex justify-between items-center p-6 border-b border-white/30">
       <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
         <i data-lucide="eye" class="w-5 h-5 text-purple-600"></i> æœ€ä½³ç¤ºä¾‹é¢„è§ˆ
       </h3>
        <button id="closePreviewBtn" class="w-8 h-8 rounded-full bg-white/50 text-slate-600 flex items-center justify-center hover:bg-white transition-colors backdrop-blur-sm">
          <i data-lucide="x" class="w-4 h-4"></i>
        </button>
     </div>
      <div id="examplePreviewTableWrap" class="flex-1 overflow-auto p-6">
        <table id="examplePreviewTable" class="w-full text-left text-sm border-collapse">
          <thead></thead>
          <tbody></tbody>
       </table>
      </div>
   </div>
  </div>

<script>
// åˆå§‹åŒ–å›¾æ ‡
lucide.createIcons();

const API = "https://localize-proxy.ne0s0u1-pd.workers.dev";
const sleep = (ms)=>new Promise(r=>setTimeout(r, ms));

// æ˜¾ç¤º Result Container
const resultContainer = document.getElementById('resultContainer');

function getBatchSize(){
  const elInput = document.getElementById("batchSize");
  const v = elInput ? parseInt(elInput.value,10) : 50;
  return Number.isFinite(v) && v > 0 ? v : 50;
}

const el = {
  src: document.getElementById("sourceText"),
  status: document.getElementById("status"),
  tableWrap: document.getElementById("tableWrap"),
  table: document.getElementById("resultTable"),
  theadRow: document.querySelector("#resultTable thead tr"),
  tbody: document.querySelector("#resultTable tbody"),
  runBtn: document.getElementById("runBtn"),
  copyBtn: document.getElementById("copyBtn"),
  dlBtn: document.getElementById("dlBtn"),
  toast: document.getElementById("toast"),
  toastMsg: document.getElementById("toastMsg")
};

const _userKeyInput = document.getElementById("userApiKey");
if (_userKeyInput) {
  _userKeyInput.value = localStorage.getItem("apicore_user_key") || "";
  _userKeyInput.addEventListener("input", () => {
    localStorage.setItem("apicore_user_key", _userKeyInput.value);
  });
}

const list = document.getElementById('headerList');
let dragItem = null;
list.addEventListener('dragstart', e => {
  dragItem = e.target.closest('li');
  if(dragItem) dragItem.classList.add('dragging');
});
list.addEventListener('dragend', e => {
  if(e.target.closest('li')) e.target.closest('li').classList.remove('dragging');
  dragItem = null;
});
list.addEventListener('dragover', e => {
  e.preventDefault();
  const target = e.target.closest('li');
  if (target && dragItem && target !== dragItem) {
    const rect = target.getBoundingClientRect();
    const next = (e.clientX - rect.left) / (rect.right - rect.left) > 0.5;
    list.insertBefore(dragItem, next ? target.nextSibling : target);
  }
});
function getHeaderOrder() {
  return Array.from(list.querySelectorAll('li')).map(li => li.dataset.code);
}

function showToast(msg){
  el.toastMsg.textContent = msg;
  el.toast.classList.remove("opacity-0", "translate-y-[-20px]");
  setTimeout(()=> el.toast.classList.add("opacity-0", "translate-y-[-20px]"), 2000);
}

function sanitizeKeepBr(html){
  return html.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi, "");
}

function splitLines(s){
  return s.split(/\r?\n/).filter(line => line.trim().length>0);
}

function parseTSV(tsv){
  tsv = tsv.replace(/^```[\s\S]*?\n/,"").replace(/```$/,"").trim();
  const lines = tsv.split(/\r?\n/);
  return lines.map(line => line.split("\t"));
}

// ğŸ”¥ ä¿®æ”¹åçš„ renderTableï¼Œæ³¨å…¥ Tailwind ç±»å ğŸ”¥
function renderTable(rows, inputLineCount){
  const header = rows[0] || [];
  el.theadRow.innerHTML = "";
  header.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    // Tailwind Header Styles - æ›´é€
    th.className = "px-6 py-4 bg-white/60 backdrop-blur sticky top-0 font-bold text-slate-600 border-b border-white/40 z-10";
    el.theadRow.appendChild(th);
  });

  el.tbody.innerHTML = "";
  const dataRows = rows.slice(1);
  let missingCount = 0;
  dataRows.forEach(cols => {
    const tr = document.createElement("tr");
    // Tailwind Row Styles
    tr.className = "hover:bg-purple-50/40 transition-colors group";
    header.forEach((_, i) => {
      const td = document.createElement("td");
      const val = (cols[i] ?? "").trim();
      // Tailwind Cell Styles
      td.className = "px-6 py-4 border-b border-white/30 group-last:border-none align-top leading-relaxed text-slate-700";
      
      if (!val) { 
        td.classList.add("bg-red-50/60", "text-red-500"); 
        missingCount++; 
      }
      td.innerHTML = sanitizeKeepBr(val);
      tr.appendChild(td);
    });
    el.tbody.appendChild(tr);
  });

  resultContainer.classList.remove('hidden');
  el.tableWrap.style.display = "block";
  
  const outLines = dataRows.length;
  let statusHTML = "";
  let statusClass = "";

  if (outLines !== inputLineCount) {
    statusClass = "bg-red-50/60 text-red-600 border-red-100/50";
    statusHTML = `<i data-lucide="alert-triangle" class="w-4 h-4"></i> è¡Œæ•°ä¸ä¸€è‡´ï¼šè¾“å…¥ ${inputLineCount} è¡Œï¼Œè¾“å‡º ${outLines} è¡Œï¼›ç©ºå•å…ƒæ ¼ ${missingCount} ä¸ªã€‚`;
  } else if (missingCount > 0) {
    statusClass = "bg-orange-50/60 text-orange-600 border-orange-100/50";
    statusHTML = `<i data-lucide="alert-circle" class="w-4 h-4"></i> æ£€æµ‹åˆ° ${missingCount} ä¸ªç©ºå•å…ƒæ ¼ï¼ˆå¯èƒ½æ¼è¯‘ï¼‰ã€‚`;
  } else {
    statusClass = "bg-green-50/60 text-green-600 border-green-100/50";
    statusHTML = `<i data-lucide="check-circle" class="w-4 h-4"></i> ç¿»è¯‘å®Œæˆï¼Œè¡Œæ•°åŒ¹é…ï¼Œæ— ç©ºå•å…ƒæ ¼ã€‚`;
  }
  
  el.status.className = `mt-6 p-4 rounded-xl border text-sm font-medium flex items-center gap-3 backdrop-blur-sm shadow-sm ${statusClass}`;
  el.status.innerHTML = statusHTML;
  lucide.createIcons(); // Refresh icons in status
}

async function translateAndRender(){
  const input = el.src.value.trim();
  const examples = document.getElementById("bestExamples").value.trim();
  const customPrompt = (document.getElementById("customPrompt")?.value || "").trim();
  const inputLines = splitLines(input);
  if (!input){ showToast("è¯·è¾“å…¥è‹±æ–‡æ–‡æœ¬"); return; }

  const BATCH_SIZE = getBatchSize();
  
  el.status.className = "mt-6 p-4 rounded-xl bg-blue-50/60 text-blue-600 border border-blue-100/50 text-sm font-medium flex items-center gap-3 backdrop-blur-sm";
  el.status.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> å‡†å¤‡åˆ†æ‰¹â€¦`;
  lucide.createIcons();

  el.tableWrap.style.display = "none"; 
  el.runBtn.disabled = true;
  el.runBtn.classList.add("opacity-70", "cursor-not-allowed");

  try {
    const total = inputLines.length; let offset = 0; let combinedTSV = "";
    const totalBatches = Math.ceil(total / BATCH_SIZE);
    for (let i=1;i<=totalBatches;i++){
      el.status.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> ç¿»è¯‘ä¸­â€¦ ç¬¬ ${i}/${totalBatches} æ‰¹`;
      lucide.createIcons();
      
      const res = await fetch(API,{
        method:"POST",headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          text:inputLines.join("\n"),examples,customPrompt,
          headerOrder:getHeaderOrder(),offset,batchSize:BATCH_SIZE,
          userApiKey:(document.getElementById("userApiKey")?.value||"").trim()
        })
      });
      if(!res.ok) throw new Error("è¯·æ±‚å¤±è´¥");
      const data=await res.json();
      if(data.error){throw new Error(data.error.message||"åç«¯é”™è¯¯");}
      combinedTSV += (combinedTSV?"\n":"")+(data.table||"").trim();
      offset += BATCH_SIZE; await sleep(1500);
    }
    const rows=parseTSV(combinedTSV);
    renderTable(rows,inputLines.length);
    el.tableWrap.dataset.tsv=rows.map(r=>r.join("\t")).join("\n");
  }catch(e){
    el.status.className="mt-6 p-4 rounded-xl bg-red-50/60 text-red-600 border border-red-100/50 text-sm font-medium flex items-center gap-3 backdrop-blur-sm";
    el.status.innerHTML=`<i data-lucide="x-circle" class="w-4 h-4"></i> è¯·æ±‚å¤±è´¥ï¼š${e.message}`;
    lucide.createIcons();
  }finally{
    el.runBtn.disabled=false;
    el.runBtn.classList.remove("opacity-70", "cursor-not-allowed");
  }
}

async function robustCopy(text){
  if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(text);return;}
  const ta=document.createElement("textarea");
  ta.value=text;ta.style.position="absolute";ta.style.left="-9999px";document.body.appendChild(ta);
  ta.select();document.execCommand("copy");document.body.removeChild(ta);
}

el.runBtn.addEventListener("click",translateAndRender);
el.copyBtn.addEventListener("click",async()=>{
  const tsv=el.tableWrap.dataset.tsv||"";const lines=tsv.split(/\r?\n/);
  const noHeader=lines.length>1?lines.slice(1).join("\n"):"";
  if(!noHeader.trim()){showToast("æ²¡æœ‰å¯å¤åˆ¶çš„ TSV");return;}
  await robustCopy(noHeader);showToast("å·²å¤åˆ¶ TSV");
});
el.dlBtn.addEventListener("click",()=>{
  const tsv=el.tableWrap.dataset.tsv||"";if(!tsv.trim()){showToast("æ²¡æœ‰å¯ä¸‹è½½çš„ TSV");return;}
  const blob=new Blob([tsv],{type:"text/tab-separated-values;charset=utf-8"});
  const url=URL.createObjectURL(blob);const a=document.createElement("a");
  a.href=url;a.download="translations.tsv";a.click();URL.revokeObjectURL(url);
});

// é¢„è®¾é€»è¾‘ä¿æŒä¸å˜
const presetSelect = document.getElementById("presetPrompt");
const customPromptArea = document.getElementById("customPrompt");

if (presetSelect && customPromptArea) {
  const presets = {
    music: `æ­¤æ¬¡ä»»åŠ¡æ˜¯è¿›è¡ŒAIéŸ³ä¹SAASç½‘ç«™çš„æ–‡æ¡ˆç¿»è¯‘ï¼Œéœ€è¦å°†ä¸ AI éŸ³ä¹åˆ›ä½œã€æ··éŸ³ã€æ¯å¸¦ã€æ­Œè¯æˆ–éŸ³é¢‘å·¥å…·ç›¸å…³çš„æ–‡æœ¬ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€ï¼Œä½¿å…¶è‡ªç„¶ã€æœ¬åœ°åŒ–ã€ç¬¦åˆéŸ³ä¹è¡Œä¸šæœ¯è¯­åŠ SEO è¡¨è¾¾ï¼Œé€‚ç”¨äºå…¨çƒéŸ³ä¹ç”Ÿæˆå¹³å°ã€éŸ³é¢‘å·¥å…·ç½‘ç«™å’Œå¤šè¯­è¨€äº§å“é¡µé¢ã€‚\n\nè§„åˆ™ï¼š\n- ä¿ç•™åŸæ–‡æ ¼å¼ä¸æ’ç‰ˆï¼Œä¸å¢åˆ å†…å®¹ã€‚\n- JSONæ ¼å¼çš„æ•°æ®è¦ä¿ç•™åŸæœ‰ç»“æ„ï¼Œä¸èƒ½å½±å“å¼€å‘ï¼ŒåŒ…æ‹¬å…¨éƒ¨çš„[]{}ï¼Œä¿ç•™è‹±æ–‡çš„é€—å·,è‹±æ–‡çš„å¼•å·""ï¼Œjsonä¸­çš„keyä¿ç•™ä¸ç¿»è¯‘ç­‰ç­‰\n- ç¿»è¯‘éœ€å…¼é¡¾éŸ³ä¹åˆ¶ä½œã€AI åˆ›ä½œä¸éŸ³é¢‘å·¥ç¨‹é¢†åŸŸçš„ä¸“ä¸šå‡†ç¡®æ€§ã€‚\n- äº§å“åæˆ–å“ç‰Œåä¿æŒåŸæ–‡ï¼ˆå¦‚ MusicCreator AIã€Sunoã€OpenMusicï¼‰ã€‚\n- ç¼ºå°‘åˆé€‚è¯‘è¯æ—¶å¯ä¿ç•™è‹±æ–‡åŸæ–‡ï¼Œä½†éœ€ç¬¦åˆç›®æ ‡è¯­è¨€è¯­åºã€‚\n- è¯­è¨€é£æ ¼ï¼š\n- ä¸“ä¸šã€è‡ªç„¶ã€é¢å‘åˆ›ä½œè€…ã€åˆ¶ä½œäººã€è‰ºæœ¯å®¶åŠæ™®é€šç”¨æˆ·ã€‚\n- ç”¨è¯åº”æ¸…æ™°ã€ç®€æ´ï¼Œé¿å…è¿‡åº¦è¥é”€æˆ–æœºæ¢°ç›´è¯‘ã€‚\n- å¯¹äºåŸè‹±æ–‡ä¸­çš„è¿è¯ç¬¦ï¼Œéœ€è¦åœ¨ä¸åŒç›®æ ‡è¯­è¨€ä¸‹ç»“åˆå¥æ„ï¼Œè¯­å¢ƒï¼Œè°ƒæ•´å¥½è¡¨è¾¾çš„è¯­åº\n- åœ¨æè¿°åŠŸèƒ½æˆ–æµç¨‹æ—¶ï¼Œåº”é‡‡ç”¨éŸ³ä¹äººå¸¸ç”¨è¡¨è¾¾æ–¹å¼ã€‚\n- è‹¥æ¶‰åŠ SEO æè¿°ï¼Œä¼˜å…ˆä½¿ç”¨è¡Œä¸šä¸­æœç´¢é‡è¾ƒé«˜çš„è‡ªç„¶è¯´æ³•ã€‚\n\nè¯´æ˜ï¼š\n- ä¿ç•™æ‰€æœ‰éŸ³é¢‘å‚æ•°ã€ç¬¦å·ã€å ä½ç¬¦åŠ HTML æ ‡ç­¾ã€‚\n- ç¿»è¯‘éŸ³ä¹åŠŸèƒ½æœ¯è¯­æ—¶éµå¾ªä¸“ä¸šæ ‡å‡†ï¼Œå¦‚ EQã€DAWã€compressorã€vocalã€drum loopã€BPM ç­‰ã€‚\n- è‹¥å‡ºç°æµæ´¾æˆ–é£æ ¼è¯æ±‡ï¼ˆå¦‚ lofiã€phonkã€EDMã€jazzï¼‰ï¼Œä¿æŒåŸæ–‡æ‹¼å†™ã€‚\n- ä¿ç•™éŸ³ä¹å“ç‰Œä¸äº§å“åï¼Œä¸è¿›è¡Œç¿»è¯‘æˆ–æ”¹å†™ã€‚\n- è¯­æ°”åº”ç¬¦åˆéŸ³ä¹å¹³å°é£æ ¼ï¼šåˆ›æ„ã€è‡ªç”±ã€é¼“åŠ±è¡¨è¾¾ã€å…¼å…·ä¸“ä¸šåº¦ã€‚`,
    coloring: `æ­¤æ¬¡ä»»åŠ¡æ˜¯å°†ä¸å¡«è‰²é¡µç›¸å…³çš„æç¤ºè¯ã€æè¿°æˆ–å„¿ç«¥å‹å¥½å‹å›¾åƒè¯´æ˜ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€ï¼Œä½¿å…¶è‡ªç„¶ã€æœ¬åœ°åŒ–ã€å…·è§†è§‰æè¿°æ€§ï¼Œé€‚ç”¨äºå…¨çƒå¡«è‰²é¡µç½‘ç«™ã€å›¾åƒç”Ÿæˆæ¨¡å‹åŠå¤šè¯­è¨€å•†å“é¡µé¢ã€‚\n\nè§„åˆ™ï¼š\nä¿ç•™åŸæ–‡çš„æ ¼å¼ä¸æ’ç‰ˆï¼Œä¸å¢åˆ å†…å®¹ã€‚\nä¿ç•™æ‰€æœ‰æŠ€æœ¯è¯æ±‡ï¼ˆå¦‚ outline onlyã€ratio 2:3ã€no shadowã€black and white ç­‰ï¼‰ã€‚\nåŸå§‹çš„è§†è§‰ç»“æ„è¯´æ˜å¿…é¡»å®Œæ•´ä¿ç•™ã€‚\näººç‰©ã€è§’è‰²æˆ– IP åç§°ä½¿ç”¨å„è¯­è¨€ä¸­æœ€å¸¸ç”¨ã€å®˜æ–¹æˆ–å¹¿ä¸ºäººçŸ¥çš„åç§°ï¼Œé¿å…ç›´è¯‘æˆ–éŸ³è¯‘ã€‚\nå½“ç›®æ ‡è¯­è¨€ä¸­ç¼ºå°‘å¯¹åº”æœ¯è¯­æ—¶ï¼Œå¯ä¿ç•™è‹±æ–‡åŸæ–‡ã€‚\n\nè¯­è¨€é£æ ¼ï¼š\næ¸©å’Œã€æœ‰æƒ³è±¡åŠ›ã€å…·è§†è§‰æ„Ÿã€‚\né¢å‘å„¿ç«¥ã€å®¶é•¿æˆ–åˆ›ä½œè€…ã€‚\nè‹¥ä¸º AI å›¾åƒæç¤ºï¼Œåº”ç®€æ´ã€æ¸…æ™°ã€‚\né¿å…ç”Ÿç¡¬ç›´è¯‘æˆ–æœºæ¢°è¡¨è¾¾ã€‚\n\nç¿»è¯‘æµç¨‹ï¼š\nâ‘  ç›´è¯‘ï¼ˆLiteral Translationï¼‰ï¼šé€å­—é€å¥ç¿»è¯‘ï¼Œä¿ç•™ç»“æ„ã€æŠ€æœ¯è¯ã€æ’ç‰ˆã€‚\nâ‘¡ è¯„ä¼°ä¸åæ€ï¼ˆEvaluation and Reflectionï¼‰ï¼šç®€è¦è¯´æ˜ç›´è¯‘ä¸­çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ä¸è‡ªç„¶è¡¨è¾¾ã€è§†è§‰è¯­ä¹‰æ˜¯å¦å‡†ç¡®ã€æŠ€æœ¯æè¿°æ˜¯å¦æ¸…æ™°ã€‚\nâ‘¢ æœ¬åœ°åŒ–è¯‘æ–‡ï¼ˆFree Translationï¼‰ï¼šåŸºäºåæ€é‡æ–°ç¿»è¯‘ï¼Œä½¿è¯­æ°”è‡ªç„¶ã€ç”ŸåŠ¨ã€æ–‡åŒ–å¥‘åˆï¼ŒåŒæ—¶ä¿æŒè§†è§‰ä¸æŠ€æœ¯å‡†ç¡®æ€§ã€‚\n\nè¯´æ˜ï¼š\nä¿ç•™è§’è‰²åã€æ–‡åŒ–åè¯ã€å›¾åƒç‰¹å¾ã€‚\nè‹¥æ–‡æœ¬æè¿°åœºæ™¯ï¼Œåº”å…·ç”»é¢æ„Ÿä¸æ•…äº‹æ€§ã€‚\nå¯¹äºçŸ¥åè§’è‰²ï¼ˆå¦‚ Spidermanã€Elsaã€Hello Kittyï¼‰ï¼Œä½¿ç”¨å½“åœ°å¸¸ç”¨æˆ–å®˜æ–¹åç§°ã€‚\nè‹¥ä¸ç¡®å®šï¼Œé‡‡ç”¨è¯¥è¯­è¨€ä¸­æœç´¢é‡æœ€é«˜çš„ç‰ˆæœ¬ï¼Œä¸å¯éšæ„éŸ³è¯‘ã€‚`
  };
  presetSelect.addEventListener("change", () => {
    const v = presetSelect.value;
    if (v && presets[v]) customPromptArea.value = presets[v];
    else customPromptArea.value = "";
  });
}

const examplePreset = document.getElementById("examplePreset");
const bestExamplesArea = document.getElementById("bestExamples");
if (examplePreset && bestExamplesArea) {
    // ç®€åŒ–äº†ç¤ºä¾‹æ•°æ®ä»¥èŠ‚çœç©ºé—´ï¼Œé€»è¾‘æœªå˜
    const examplePresets = {
    music: `è‹±è¯­	ja	de	pt	es	fr	ko	vi
beats	æ‰“ã¡è¾¼ã¿ éŸ³æ¥½	beats	batidas	ritmos	Beats	beats	nhá»‹p Ä‘iá»‡u
FREE	ç„¡æ–™	Kostenlos	GrÃ¡tis	Gratis	Gratuit	ë¬´ë£Œ	miá»…n phÃ­
karaoke	ã‚«ãƒ©ã‚ªã‚±ã‚¢ãƒ—ãƒªç„¡æ–™	Karaoke	karaokÃª	karaoke	KaraokÃ©	ê°€ë¼ì˜¤ì¼€	hÃ¡t karaoke
Online	ã‚ªãƒ³ãƒ©ã‚¤ãƒ³	Online	Na rede	En lÃ­nea	En Ligne	ì˜¨ë¼ì¸	trá»±c tuyáº¿n
Lofi	Lofi	Lo-fi	Lofi	Lofi	Lofi	Lofi	Lofi
AI Music Generator	éŸ³æ¥½ç”Ÿæˆ AI	KI Musik Generator	Gerador de MÃºsica IA	Generador de MÃºsica IA	IA Musique Gratuite	AI ë…¸ë˜ ë§Œë“¤ê¸°	                                            
AI Voice	AIæ­Œå£°	KI Stimme	Voz artificial	Voz de IA	IA Voix	AI ë³´ì´ìŠ¤	giá»ng AI
soundtrack	ã‚µãƒ³ãƒˆãƒ©	Soundtrack	Trilha Sonora	banda sonora	Bande Sonore	OST	nháº¡c phim
AI Music	AI éŸ³æ¥½	KI Musik	MÃºsica IA	MÃºsica IA	IA Musique	AI ë…¸ë˜	AI hÃ¡t
BPM Tapper	BPMã‚«ã‚¦ãƒ³ã‚¿ãƒ¼	BPM Messer	Tempo tapper	Calculadora de BPM	DÃ©tecteur De BPM	BPM ì¸¡ì •	tempo tap
AI Lyrics Generator	æ­Œè© ä½œã‚‹ ã‚µã‚¤ãƒˆ	KI-Textgenerator	Gerador de Letras IA	Generador de Letras IA	GÃ©nÃ©rateur De Parole IA	ë© ê°€ì‚¬ ì“°ëŠ” ì‚¬ì´íŠ¸	táº¡o lá»i bÃ i hÃ¡t AI
remove vocals	ãƒœãƒ¼ã‚«ãƒ«é™¤å»	Gesang entfernen	Removedor de vocal	Quitar Vocales		ë³´ì»¬ë¦¬ë¬´ë²„	tÃ¡ch giá»ng
AI Vocal Remover	ãƒœãƒ¼ã‚«ãƒ«æŠ½å‡º	KI Vocal Remover	Removedor de Vocais 	Eliminador de Voz IA	SÃ©parateur Voix Musique	ë³´ì»¬ ë¦¬ë¬´ë²„	tÃ¡ch giá»ng
Effortlessly	ç°¡å˜ã«	MÃ¼helos	Sem esforÃ§o	sin esfuerzo	Facilement	ë¬´ë£Œ	dá»… dÃ ng
Music Creator	éŸ³æ¥½ä½œæˆ	Musik Erstellen	Criador de MÃºsica	Creador de MÃºsica	Compositeur De Musique	ì‘ê³¡ í”„ë¡œê·¸ë¨	táº¡o nháº¡c
AI Rap Generator	AIãƒ©ãƒƒãƒ—ç”Ÿæˆ	KI Rap Generator	Gerador de rap de IA	Generador de rap	GÃ©nÃ©rateur de rap IA	AI ë© ìƒì„±ê¸°	táº¡o nháº¡c rap AI
AI Stem Splitter	éŸ³å£°åˆ†é›¢	KI Stem Splitter	Divisor de hastes AI	Separador de Pistas IA	SÃ©parateur De Piste Audio	ìŒì› ë¶„ë¦¬	tÃ¡ch nháº¡c vÃ  giá»ng
Voice Cloning	AI ãƒœã‚¤ã‚¹	Klonen von Gesangsstimmen	clonar voz	ClonaciÃ³n de Voz	Clonage Voix IA	AI ëª©ì†Œë¦¬ ë§Œë“¤ê¸°	táº¡o giá»ng nÃ³i AI
MIDI files	MIDIãƒ•ã‚¡ã‚¤ãƒ«	MIDI Dateien	Arquivos MIDI	archivos MIDI	Fichiers MIDI	ë¯¸ë”” íŒŒì¼ 	tá»‡p MIDI
Royalty Free	ãƒ­ã‚¤ãƒ¤ãƒªãƒ†ã‚£ãƒ•ãƒªãƒ¼	Lizenzfreie	Sem Direitos Autorais	libre de derechos	Libre De Droits	ì €ì‘ê¶Œ ì—†ëŠ”	KhÃ´ng báº£n quyá»n
AI Song Cover	AI ã‚«ãƒãƒ¼	KI Song Cover	criar capas IA	Portada de la canciÃ³n AI	Cover IA	AI ë…¸ë˜ ì»¤ë²„	bÃ i hÃ¡t cover AI
MIDI Editor	MIDIã‚¨ãƒ‡ã‚£ã‚¿	MIDI Editor	Editor MIDI	Editor MIDI	Ã‰diteur MIDI	ë¯¸ë”” ì—ë””í„°	trÃ¬nh chá»‰nh sá»­a MIDI
MIDI converter	midi å¤‰æ›	MIDI Konverter	Conversor de MIDI	convertidor MIDI	Convertisseur MIDI	ë¯¸ë”” ë³€í™˜ê¸°	chuyá»ƒn Ä‘á»•i MIDI
AI Singing Voice Generator	AI æ­Œã‚ã›ã‚‹	KI Gesangsstimmen Generator	Gerador de Voz de Canto IA	Generador de voz de canto con IA	GÃ©nÃ©rateur de Voix IA	AI ëª©ì†Œë¦¬ ë§Œë“¤ê¸°	táº¡o giá»ng hÃ¡t AI
AI Song Cover Generator	AIã‚«ãƒãƒ¼ ã‚„ã‚Šæ–¹	KI Song Cover Generator	Gerador de Covers de MÃºsicas com IA	Generador de portadas de canciones con IA	GÃ©nÃ©rateur De Cover IA	AI ë…¸ë˜ ì»¤ë²„ ë§Œë“¤ê¸°	táº¡o bÃ i hÃ¡t cover AI
AI MIDI Generator	midi å¤‰æ›	KI MIDI Generator	Gerador MIDI AI	Generador de MIDI con IA	GÃ©nÃ©rateur MIDI IA	AI ë¯¸ë”” ìƒì„±	táº¡o MIDI AI
lyrics to song generator	æ­Œè© ã‹ã‚‰ ä½œæ›²	KI Songtext erstellen	letras para gerador de mÃºsicas	letras a cancion	GÃ©nÃ©rateur De Musique Par Paroles	ê°€ì‚¬ ìŒì•… ìƒì„±ê¸°	cÃ´ng cá»¥ táº¡o nháº¡c tá»« lá»i bÃ i hÃ¡t AI
AI Instrumental Generator	bgm ä½œã‚‹ ã‚µã‚¤ãƒˆ	 KI Hintergrundmusik Generator	Gerador Instrumental de IA	Generador de Instrumentales con IA	GÃ©nÃ©rateur D'instrumental IA	AI ì•…ê¸° ìƒì„±ê¸°	táº¡o nháº¡c khÃ´ng lá»i AI
Text to Music	æ­Œè©ã‚’å…¥ã‚Œã‚‹ã ã‘ã§ä½œæ›² ã‚µã‚¤ãƒˆ	Text zu Musik	Texto para MÃºsica	Texto a mÃºsica	Texte En Musique	í…ìŠ¤íŠ¸ íˆ¬ ìŒì•…	táº¡o nháº¡c tá»« vÄƒn báº£n AI
copyright free	è‘—ä½œæ¨©ãƒ•ãƒªãƒ¼	Lizenzfrei	Uso Livre	libre de derechos de autor	Musique Sans Droit D'auteur	ì €ì‘ê¶Œ ì—†ëŠ”	KhÃ´ng báº£n quyá»n
AI Music Mastering	AIãƒã‚¹ã‚¿ãƒªãƒ³ã‚°	KI-Musik-Mastering	MasterizaÃ§Ã£o musical com IA	MasterizaciÃ³n de MÃºsica con IA	Mastering IA	AI ë§ˆìŠ¤í„°ë§	mastering AI
Making AI Music	AI éŸ³æ¥½ä½œæˆ	KI-Musik erstellen	Fazendo mÃºsica com IA	crear musica con ia	IA Musique	AI ìŒì•… ë§Œë“¤ê¸°	táº¡o nháº¡c
Generate AI Music	AI æ›² ä½œæˆ	KI Musik Erstellen	Gerar MÃºsica com IA	crear musica con ia	GÃ©nÃ©rateur De Musique IA	AI ë…¸ë˜ ë§Œë“¤ê¸°	AI nháº¡c táº¡o
Music Generation	ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³	Musikproduktion	GeraÃ§Ã£o de MÃºsica	CreaciÃ³n de MÃºsica con IA	IA Creation Musique	ìŒì•… ìƒì„±	lÃ m nháº¡c
AI Editing Tools	éŸ³æ¥½ç·¨é›†ã‚¢ãƒ—ãƒª		Ferramentas de ediÃ§Ã£o de IA	Herramientas de EdiciÃ³n con IA	Editeur IA	AI í¸ì§‘ê¸°	cÃ´ng cá»¥ chá»‰nh sá»­a AI
MUSIC CREATION TOOLS	éŸ³æ¥½ä½œæˆã‚¢ãƒ—ãƒª	MUSIKERSTELLUNGSTOOLS ENTDECKEN	FERRAMENTAS DE CRIAÃ‡ÃƒO MUSICAL	Herramientas de CreaciÃ³n Musical	Logiciel Musique	ì‘ê³¡ í”„ë¡œê·¸ë¨	phÃ²ng thu
lyrics to song maker	æ­Œè©ã‚’å…¥ã‚Œã‚‹ã ã‘ã§ä½œæ›² ã‚µã‚¤ãƒˆ	Songtext zu Musik	letras para criador de mÃºsicas	letras a cancion	Ã©nÃ©rateur de chansons Ã  partir de paroles	ê°€ì‚¬ë¥¼ ìŒì•…ìœ¼ë¡œ ë³€í™˜	cÃ´ng cá»¥ táº¡o nháº¡c tá»« lá»i bÃ i hÃ¡t AI
Lyric To Music	æ­Œè© ã‹ã‚‰ ä½œæ›²	Songtext zu Musik	Letra para MÃºsica	Letra a MÃºsica	Paroles En Musique	ê°€ì‚¬ ìŒì•… ë³€í™˜	táº¡o nháº¡c tá»« lá»i bÃ i hÃ¡t AI
Photo to Music	å†™çœŸã«éŸ³æ¥½ã‚’ã¤ã‘ã‚‹	Foto zu Musik	Foto para MÃºsica	Foto a MÃºsica	Photo En Musique	ì´ë¯¸ì§€ íˆ¬ ìŒì•…	táº¡o nháº¡c tá»« áº£nh AI
AI Text to Music Generator	AI ä½œè© ä½œæ›²	KI Text zu Musik Generator	Gerador de MÃºsica IA a partir de Texto	Generador de MÃºsica IA a partir de Texto	IA Qui Chante Un Texte	AI ìŒì•… ë§Œë“¤ê¸°	táº¡o nháº¡c tá»« vÄƒn báº£n AI
Audio Separation	éŸ³å£°åˆ†é›¢	Audiotrennung	SeparaÃ§Ã£o de Ãudio	SeparaciÃ³n de Audio	SÃ©parateur Voix Musique	ìŒì› ë¶„ë¦¬	tÃ¡ch nháº¡c vÃ  giá»ng
personal album	ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¢ãƒ«ãƒãƒ 	privates Album	Ã¡lbum pessoal	Ã¡lbum personal	Album Personnel	ì•¨ë²”	album cÃ¡ nhÃ¢n
AI MUSIC PLATFORM	AI éŸ³æ¥½	KI Musikplattform	Plataforma de MÃºsica com IA	PLATAFORMA DE MÃšSICA CON IA	Plateforme Musicale IA	AI ìŒì•…	ná»n táº£ng nháº¡c
production-ready	å³æˆ¦åŠ›	produktionsreif	pronto para produÃ§Ã£o	listas para la producciÃ³n	PrÃªt Ã€ L'emploi	ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥	Sáºµn sÃ ng Ä‘á»ƒ sá»­ dá»¥ng
make bgm	bgm ä½œã‚‹		criar fundo de musica	hacer bgm	CrÃ©er Une Musique De Fond	bgm ë§Œë“¤ê¸°	táº¡o nháº¡c ná»n
AI song maker	AIä½œæ›²ãƒ„ãƒ¼ãƒ«	KI-Song-Maker	Criador de canÃ§Ãµes com IA	creador de canciones con IA	CrÃ©er De La Musique Avec L'IA	AI ë…¸ë˜ë§Œë“¤ê¸°	táº¡o nháº¡c
Slowed + Reverb	ã‚¹ãƒ­ãƒ¼+ãƒªãƒãƒ¼ãƒ–	Verlangsamt und Hall	Desacelerado + Reverb	Ralentizado + Reverb	Ralenti + RÃ©verbÃ©ration	ëŠë ¤ì§ + ë¦¬ë²„ë¸Œ	Cháº­m + Reverb
Noise Generator	ãƒã‚¤ã‚ºã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼	Rauschgenerator	Gerador de ruÃ­do	Generador de ruido	GÃ©nÃ©rateur de bruit	ë…¸ì´ì¦ˆ ìƒì„±ê¸°	TrÃ¬nh táº¡o tiáº¿ng á»“n
Chord Progression	ã‚³ãƒ¼ãƒ‰é€²è¡Œ	Akkordfolge	ProgressÃ£o de Acordes	ProgresiÃ³n de Acordes	Progression d'accords	ì½”ë“œ ì§„í–‰	Chuá»—i há»£p Ã¢m
8-Bit	8ãƒ“ãƒƒãƒˆ	8 Bit	8 bits	8 bits	8 bits	8ë¹„íŠ¸	8-bit
AI Background Music Generator	AIèƒŒæ™¯éŸ³æ¥½ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼	KI Hintergrundmusik Generator	Gerador de MÃºsica de Fundo com IA	Generador de MÃºsica de Fondo con IA	GÃ©nÃ©rateur de musique de fond IA	AI ë°°ê²½ ìŒì•… ìƒì„±ê¸°	TrÃ¬nh táº¡o nháº¡c ná»n AI
Lofi Converter	ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼	Lo-Fi Konverter	Conversor Lofi	Convertidor Lofi	Convertisseur Lo-fi	ë¡œíŒŒì´ ë³€í™˜ê¸°	Bá»™ chuyá»ƒn Ä‘á»•i Lofi
AI Music Maker	AI éŸ³æ¥½ä½œæˆ	KI Musik Erstellen	Fazedor de MÃºsica IA	Crear Musica Con IA	CrÃ©er De La Musique Avec L'IA	AI ìŒì•… ë§Œë“¤ê¸°	CÃ´ng Cá»¥ Táº¡o Nháº¡c AI
AI Music Video Generator	AIãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ãƒ“ãƒ‡ã‚ªç”Ÿæˆ	KI Musikvideo Generator	Gerador de VÃ­deos de MÃºsica IA	Generador de Videos Musicales IA	GÃ©nÃ©rateur de VidÃ©os Musicales IA	AI ë®¤ì§ë¹„ë””ì˜¤ ìƒì„±ê¸°	TrÃ¬nh táº¡o video ca nháº¡c AI`,
    coloring: `å¾…è¡¥å……`
  };
  examplePreset.addEventListener("change", () => {
    const v = examplePreset.value;
    if (v && examplePresets[v]) bestExamplesArea.value = examplePresets[v];
    else bestExamplesArea.value = "";
  });
}

// ç¤ºä¾‹é¢„è§ˆ
const previewBtn = document.getElementById("previewExampleBtn");
const modal = document.getElementById("examplePreviewModal");
const closeBtn = document.getElementById("closePreviewBtn");
const tableWrap = document.getElementById("examplePreviewTableWrap");
const exampleTable = document.getElementById("examplePreviewTable");

function parseTSVToTable(tsvText) {
  const rows = tsvText.trim().split(/\r?\n/).map(r => r.split("\t"));
  const thead = exampleTable.querySelector("thead");
  const tbody = exampleTable.querySelector("tbody");
  thead.innerHTML = ""; tbody.innerHTML = "";
  if (rows.length === 0) return;

  const headerRow = document.createElement("tr");
  rows[0].forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    // Tailwind Header
    th.className = "px-4 py-3 bg-white/60 font-bold text-slate-700 border-b border-white/40 sticky top-0 backdrop-blur-sm";
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);

  rows.slice(1).forEach(r => {
    const tr = document.createElement("tr");
    r.forEach(c => {
      const td = document.createElement("td");
      td.textContent = c;
      // Tailwind Cell
      td.className = "px-4 py-2 border-b border-white/20 text-slate-600";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

if (previewBtn && modal && closeBtn) {
  previewBtn.addEventListener("click", () => {
    const text = document.getElementById("bestExamples").value.trim();
    if (!text) { showToast("æ²¡æœ‰å¯é¢„è§ˆçš„ç¤ºä¾‹å†…å®¹"); return; }
    parseTSVToTable(text);
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  });
  closeBtn.addEventListener("click", () => {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  });
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }
  });
}

// è¡¨æ ¼ç‚¹å‡»å¤åˆ¶
const tableBody = document.querySelector("#resultTable tbody");
if (tableBody) {
  tableBody.addEventListener("click", async (e) => {
    const td = e.target.closest("td");
    if (!td) return;
    const text = td.textContent.trim();
    if (!text) return;
    try {
      await navigator.clipboard.writeText(text);
      showToast("å·²å¤åˆ¶å•å…ƒæ ¼å†…å®¹");
      td.classList.add("bg-green-100/60");
      setTimeout(() => td.classList.remove("bg-green-100/60"), 500);
    } catch {
      showToast("å¤åˆ¶å¤±è´¥");
    }
  });
}
</script>
</body>
</html>

