<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å¤šè¯­è¨€æœ¬åœŸåŒ–ç¿»è¯‘</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:,">
<!-- å¼•å…¥å­—ä½“ -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- å¼•å…¥ Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- å¼•å…¥ Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<style>
  /* æ»šåŠ¨æ¡ç¾åŒ– */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  
  body { font-family: 'Inter', sans-serif; }
  .lucide { vertical-align: middle; }
  
  /* æ‹–æ‹½æ ·å¼ */
  .dragging { opacity: 0.5; transform: scale(0.95); }

  /* æç®€èƒŒæ™¯å‘¼å¸åŠ¨ç”» (ä»…æ”¹å˜é€æ˜åº¦ï¼Œæ€§èƒ½æ¶ˆè€—æä½) */
  @keyframes breathe {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 0.8; }
  }
  .animate-breathe { animation: breathe 8s ease-in-out infinite; }
</style>
</head>
<body class="bg-slate-50 min-h-screen p-3 md:p-8 relative selection:bg-purple-200 selection:text-purple-900 flex flex-col items-center overflow-x-hidden">

  <!-- 
     ğŸ¨ èƒŒæ™¯è£…é¥° (æé€Ÿç‰ˆ)
     ç§»é™¤äº†æ‰€æœ‰ä½ç§»åŠ¨ç”»å’Œ blur æ»¤é•œã€‚
     ä½¿ç”¨çº¯ CSS å¾„å‘æ¸å˜æ¨¡æ‹Ÿå…‰æ™•ï¼Œæ€§èƒ½ç­‰åŒäºé™æ€å›¾ç‰‡ã€‚
  -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10 bg-slate-50">
    <!-- å·¦ä¸Šç´«å…‰ -->
    <div class="absolute top-0 left-0 w-[70vw] h-[70vw] bg-[radial-gradient(circle_at_top_left,rgba(216,180,254,0.3)_0%,transparent_60%)] animate-breathe"></div>
    <!-- å³ä¸‹è“å…‰ -->
    <div class="absolute bottom-0 right-0 w-[70vw] h-[70vw] bg-[radial-gradient(circle_at_bottom_right,rgba(191,219,254,0.3)_0%,transparent_60%)] animate-breathe" style="animation-delay: 4s;"></div>
    <!-- ä¸­é—´æš–å…‰ -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[radial-gradient(circle,rgba(255,255,255,0.8)_0%,transparent_100%)]"></div>
  </div>

  <!-- ä¸»å®¹å™¨ -->
  <!-- ç§»é™¤ backdrop-blur-xlï¼Œæ”¹ç”¨ bg-white/60 å®ç°é«˜é€æ•ˆæœ -->
  <div class="container max-w-[95%] 2xl:max-w-[1600px] w-full transition-all duration-300">
    <div class="bg-white/60 rounded-[32px] border border-white/80 shadow-[0_4px_24px_rgba(0,0,0,0.02)] p-6 md:p-10 relative overflow-hidden ring-1 ring-white/60">
      
      <!-- æ ‡é¢˜åŒº -->
      <div class="flex flex-col md:flex-row items-center justify-between mb-8 border-b border-slate-200/50 pb-6 gap-4 relative z-10">
        <div class="flex items-center gap-5">
          <div class="inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-white shadow-sm border border-slate-100 shrink-0">
            <i data-lucide="languages" class="w-7 h-7 text-purple-600"></i>
          </div>
          <div>
            <h1 class="text-2xl md:text-3xl font-bold text-slate-800 tracking-tight leading-tight">å¤šè¯­è¨€æœ¬åœŸåŒ–ç¿»è¯‘</h1>
            <div class="flex items-center gap-3 mt-1.5">
               <span class="text-xs font-semibold text-slate-500 bg-white/50 px-2.5 py-0.5 rounded-md border border-slate-100">è¾“å…¥: è‹±æ–‡</span>
               <span class="text-[11px] text-slate-400 hidden md:inline-block tracking-wide">| AI-Powered Localization Tool</span>
            </div>
          </div>
        </div>
        
        <!-- æ¡Œé¢ç«¯çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <div id="status" class="hidden md:flex px-4 py-2 rounded-xl bg-white border border-slate-100 text-slate-600 text-xs font-medium items-center gap-2.5 shadow-sm">
          <span class="w-2 h-2 rounded-full bg-slate-400"></span>
          å¾…æœºä¸­
        </div>
      </div>

      <!-- æ ¸å¿ƒè®¾ç½®è¡Œ -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6 mb-6 relative z-10">
        <!-- æ‰¹å¤§å° -->
        <div class="md:col-span-2 2xl:col-span-1">
          <label class="text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1.5 ml-1 block">æ‰¹æ¬¡å¤§å°</label>
          <div class="relative group h-12">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <i data-lucide="layers" class="w-4 h-4 text-slate-400 transition-colors group-focus-within:text-purple-500"></i>
            </div>
            <input type="number" id="batchSize" value="50" min="1" max="500" placeholder="Batch"
              class="w-full h-full pl-11 pr-3 bg-white/50 border border-slate-200/50 rounded-xl text-slate-700 text-sm hover:bg-white focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all outline-none shadow-sm font-medium">
          </div>
        </div>

        <!-- API Key -->
        <div class="md:col-span-10 2xl:col-span-11">
          <label class="text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1.5 ml-1 block">API Key</label>
          <div class="relative group h-12">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <i data-lucide="key" class="w-4 h-4 text-slate-400 transition-colors group-focus-within:text-purple-500"></i>
            </div>
            <input type="password" id="userApiKey" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„ API Key (sk-...)" 
              class="w-full h-full pl-11 pr-4 bg-white/50 border border-slate-200/50 rounded-xl text-slate-700 text-sm hover:bg-white focus:bg-white focus:ring-2 focus:ring-purple-200 transition-all outline-none shadow-sm font-mono tracking-wide">
          </div>
        </div>
      </div>
      
      <!-- è¾“å…¥æºæ–‡æœ¬ -->
      <div class="mb-6 relative group z-10">
        <div class="flex justify-between items-center mb-1.5 ml-1">
            <label class="text-[11px] font-bold text-slate-500 uppercase tracking-wider">æºæ–‡æœ¬ (æ¯è¡Œä¸€ä¸ª)</label>
        </div>
        <textarea id="sourceText" placeholder="è¾“å…¥å¾…ç¿»è¯‘è¯æ±‡ (æ¯è¡Œä¸€ä¸ª)&#10;ä¾‹å¦‚ï¼š&#10;AI Stem Splitter&#10;Free Key and BPM Finder"
            class="w-full p-5 min-h-[180px] bg-white/50 border border-slate-200/50 rounded-2xl text-slate-700 placeholder-slate-400 hover:bg-white focus:bg-white focus:border-purple-200 focus:ring-4 focus:ring-purple-100/50 transition-all outline-none shadow-sm resize-y font-sans text-sm leading-relaxed"></textarea>
      </div>

      <!-- è¾…åŠ©åŠŸèƒ½åŒº -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8 relative z-10">
        <!-- å·¦ä¾§ï¼šç¤ºä¾‹ -->
        <div class="bg-white/40 rounded-2xl p-5 border border-white/60 shadow-sm hover:bg-white/80 transition-all group">
          <div class="flex justify-between items-center mb-3">
            <label class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-1.5">
              <i data-lucide="sparkles" class="w-3.5 h-3.5 text-yellow-500"></i> ç¤ºä¾‹ (Few-Shot)
            </label>
            <div class="flex gap-2">
                <select id="examplePreset" class="text-[11px] bg-white/80 border-none rounded-lg px-2.5 py-1 text-slate-700 shadow-sm cursor-pointer hover:bg-white focus:ring-1 focus:ring-purple-200 outline-none transition-colors font-medium">
                  <option value="">ğŸ“‹ åŠ è½½é¢„è®¾...</option>
                  <option value="music">ğŸµ éŸ³ä¹åœºæ™¯</option>
                  <option value="coloring">ğŸ¨ å¡«è‰²åœºæ™¯</option>
                </select>
                <button id="previewExampleBtn" class="text-[11px] bg-white/80 px-3 py-1 rounded-lg text-slate-600 hover:text-purple-600 hover:bg-white transition-all border border-transparent hover:border-purple-100 font-medium shadow-sm">
                    é¢„è§ˆè¡¨æ ¼
                </button>
            </div>
          </div>
          <textarea id="bestExamples" placeholder="ç¤ºä¾‹æ ¼å¼ï¼š&#10;AI Stem Splitter => AI éŸ³è½¨åˆ†ç¦»å™¨"
            class="w-full p-4 h-32 bg-white/50 border border-slate-200/30 rounded-xl text-slate-700 placeholder-slate-400 focus:bg-white focus:ring-2 focus:ring-purple-100/50 transition-all outline-none text-xs resize-none hover:bg-white/80"></textarea>
        </div>

        <!-- å³ä¾§ï¼šæç¤ºè¯ -->
        <div class="bg-white/40 rounded-2xl p-5 border border-white/60 shadow-sm hover:bg-white/80 transition-all group">
          <div class="flex justify-between items-center mb-3">
             <label class="text-xs font-bold text-slate-500 uppercase tracking-wider flex items-center gap-1.5">
              <i data-lucide="message-square-dashed" class="w-3.5 h-3.5 text-blue-500"></i> ç³»ç»Ÿæç¤ºè¯
            </label>
            <select id="presetPrompt" class="text-[11px] bg-white/80 border-none rounded-lg px-2.5 py-1 text-slate-700 shadow-sm cursor-pointer hover:bg-white focus:ring-1 focus:ring-purple-200 outline-none transition-colors font-medium">
              <option value="">ğŸ¤– åŠ è½½é¢„è®¾...</option>
              <option value="music">éŸ³ä¹ç«™</option>
              <option value="coloring">å¡«è‰²é¡µ</option>
              <option value="tattoog">çº¹èº«ç«™</option>
            </select>
          </div>
          <textarea id="customPrompt" placeholder="ä¾‹å¦‚ï¼šè¯·ä¿æŒä¸“ä¸šè¯­æ°”ï¼Œé‡åˆ°ä¸“æœ‰åè¯ä¿ç•™è‹±æ–‡..."
            class="w-full p-4 h-32 bg-white/50 border border-slate-200/30 rounded-xl text-slate-700 placeholder-slate-400 focus:bg-white focus:ring-2 focus:ring-purple-100/50 transition-all outline-none text-xs resize-none hover:bg-white/80"></textarea>
        </div>
      </div>

      <!-- åº•éƒ¨å·¥å…·æ  -->
      <div class="flex flex-col lg:flex-row items-end lg:items-center gap-6 border-t border-slate-200/50 pt-6 relative z-10">
        
        <!-- æ‹–æ‹½æ’åº -->
        <div class="flex-1 w-full">
            <div class="text-[11px] font-bold text-slate-400 uppercase mb-3 ml-1 tracking-wider flex items-center gap-2">
                <i data-lucide="arrow-left-right" class="w-3 h-3"></i> è¾“å‡ºåˆ—é¡ºåº (æ‹–æ‹½è°ƒæ•´)
            </div>
            <ul id="headerList" class="flex flex-wrap gap-2.5">
              <!-- zh -->
              <li draggable="true" data-code="zh" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                <span class="w-1.5 h-1.5 rounded-full bg-red-400"></span> zh
              </li>
              <!-- ja -->
              <li draggable="true" data-code="ja" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                <span class="w-1.5 h-1.5 rounded-full bg-pink-400"></span> ja
              </li>
              <!-- de -->
              <li draggable="true" data-code="de" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                <span class="w-1.5 h-1.5 rounded-full bg-yellow-400"></span> de
              </li>
              <!-- pt -->
              <li draggable="true" data-code="pt" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                <span class="w-1.5 h-1.5 rounded-full bg-green-400"></span> pt
              </li>
              <!-- es -->
              <li draggable="true" data-code="es" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                <span class="w-1.5 h-1.5 rounded-full bg-orange-400"></span> es
              </li>
              <!-- fr -->
              <li draggable="true" data-code="fr" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                <span class="w-1.5 h-1.5 rounded-full bg-blue-400"></span> fr
              </li>
              <!-- ko -->
              <li draggable="true" data-code="ko" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                <span class="w-1.5 h-1.5 rounded-full bg-teal-400"></span> ko
              </li>
              <!-- tw -->
              <li draggable="true" data-code="tw" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                 <span class="w-1.5 h-1.5 rounded-full bg-red-300"></span> tw
              </li>
              <!-- vi -->
              <li draggable="true" data-code="vi" class="cursor-grab active:cursor-grabbing bg-white text-slate-700 px-3.5 py-2 rounded-lg border border-slate-200 shadow-sm text-xs font-bold hover:border-purple-200 hover:text-purple-600 hover:shadow-md hover:-translate-y-0.5 transition-all select-none flex items-center gap-1.5">
                 <span class="w-1.5 h-1.5 rounded-full bg-red-600"></span> vi
              </li>
            </ul>
        </div>

        <!-- æŒ‰é’®ç»„ -->
        <div class="flex gap-3 w-full lg:w-auto mt-2 lg:mt-0">
          <button id="copyBtn" class="flex-1 lg:flex-none h-12 px-6 rounded-xl bg-white text-purple-700 font-semibold border border-purple-100 shadow-sm hover:bg-purple-50 hover:shadow-md hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 text-sm group">
            <i data-lucide="clipboard-check" class="w-4.5 h-4.5 group-hover:scale-110 transition-transform"></i> å¤åˆ¶ TSV
          </button>
          <button id="dlBtn" class="flex-1 lg:flex-none h-12 px-6 rounded-xl bg-white text-slate-700 font-semibold border border-slate-200 shadow-sm hover:bg-slate-50 hover:shadow-md hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 text-sm group">
            <i data-lucide="download" class="w-4.5 h-4.5 group-hover:scale-110 transition-transform"></i> ä¸‹è½½
          </button>
          <button id="runBtn" class="flex-[2] lg:flex-none h-12 px-10 rounded-xl bg-slate-800 text-white font-bold shadow-lg shadow-slate-400/30 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2.5 text-sm hover:bg-slate-900">
            <i data-lucide="rocket" class="w-5 h-5"></i> ç«‹å³ç¿»è¯‘
          </button>
        </div>
      </div>

      <!-- ç§»åŠ¨ç«¯å¯è§çš„çŠ¶æ€æ¡ -->
      <div id="statusMobile" class="md:hidden mt-5 p-3 rounded-xl bg-white border border-slate-200 text-slate-600 text-xs font-medium flex items-center gap-2 shadow-sm">
        <span class="w-2 h-2 rounded-full bg-slate-400"></span>
        å¾…æœºä¸­
      </div>

    </div>

    <!-- ç»“æœå±•ç¤ºåŒº -->
    <div class="result-section mt-6 bg-white/50 rounded-[32px] border border-white/60 shadow-[0_8px_30px_rgba(0,0,0,0.04)] p-6 md:p-10 relative hidden ring-1 ring-white/50 transition-all" id="resultContainer">
      <h2 class="text-xl font-bold text-slate-800 mb-5 flex items-center gap-2.5">
        <div class="p-2 bg-green-100 rounded-lg text-green-700">
          <i data-lucide="table-2" class="w-5 h-5"></i>
        </div>
        ç¿»è¯‘ç»“æœ
      </h2>
      
      <div class="table-wrap overflow-x-auto rounded-2xl border border-slate-200/50 shadow-sm bg-white/40 transition-all" id="tableWrap" style="display:none;">
        <table id="resultTable" class="w-full text-left border-collapse min-w-[800px]">
          <thead><tr class="bg-white/80 border-b border-slate-200 text-xs uppercase text-slate-600 font-bold tracking-wider"></tr></thead>
          <tbody class="divide-y divide-slate-200/50 text-sm text-slate-700"></tbody>
        </table>
      </div>
      <div class="text-[11px] text-slate-500 mt-4 flex items-center gap-1.5 font-medium bg-white/40 inline-flex px-3 py-1 rounded-full border border-slate-200/50">
        <i data-lucide="info" class="w-3.5 h-3.5"></i>
        æ³¨ï¼šç©ºç™½å•å…ƒæ ¼æ ‡çº¢è¡¨ç¤ºå¯èƒ½æ¼è¯‘ï¼›HTML æ ‡ç­¾ä¸å ä½ç¬¦åŸæ ·ä¿ç•™ã€‚
      </div>
    </div>
  </div>

  <!-- å…¨å±€ Toast é€šçŸ¥ -->
  <div class="toast fixed top-8 right-8 bg-slate-800 text-white px-6 py-3 rounded-2xl shadow-2xl text-sm font-medium flex items-center gap-3 opacity-0 translate-y-[-20px] transition-all duration-300 z-[100] border border-white/10" id="toast">
    <i data-lucide="check-circle-2" class="w-5 h-5 text-green-400"></i>
    <span id="toastMsg">å·²å¤åˆ¶</span>
  </div>

  <!-- ç¤ºä¾‹é¢„è§ˆæ¨¡æ€æ¡† -->
  <div id="examplePreviewModal" class="fixed inset-0 z-[1000] hidden items-center justify-center bg-slate-900/20 backdrop-blur-none p-4 transition-all">
   <div class="bg-white rounded-[32px] w-full max-w-5xl max-h-[85vh] flex flex-col shadow-2xl border border-white ring-1 ring-slate-200">
      <div class="flex justify-between items-center p-6 border-b border-slate-100">
       <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
         <i data-lucide="eye" class="w-5 h-5 text-purple-600"></i> æœ€ä½³ç¤ºä¾‹é¢„è§ˆ
       </h3>
        <button id="closePreviewBtn" class="w-8 h-8 rounded-full bg-slate-50 text-slate-600 flex items-center justify-center hover:bg-slate-100 transition-colors">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
     </div>
      <div id="examplePreviewTableWrap" class="flex-1 overflow-auto p-6">
        <table id="examplePreviewTable" class="w-full text-left text-sm border-collapse min-w-[600px]">
          <thead></thead>
          <tbody></tbody>
       </table>
      </div>
   </div>
  </div>

<!-- é€»è¾‘ä»£ç åŒº (åŠŸèƒ½å®Œå…¨ä¿ç•™) -->
<script>
// åˆå§‹åŒ–å›¾æ ‡
lucide.createIcons();

const API = "https://localize-proxy.ne0s0u1-pd.workers.dev";
const sleep = (ms)=>new Promise(r=>setTimeout(r, ms));

// æ˜¾ç¤º Result Container
const resultContainer = document.getElementById('resultContainer');
// çŠ¶æ€æ 
const statusDesktop = document.getElementById("status");
const statusMobile = document.getElementById("statusMobile");

function updateStatus(html, className) {
  const innerContent = html;
  if (statusDesktop) {
    statusDesktop.className = `hidden md:flex px-4 py-2 rounded-xl text-xs font-medium items-center gap-2.5 shadow-sm border ${className}`;
    statusDesktop.innerHTML = innerContent;
  }
  if (statusMobile) {
    statusMobile.className = `md:hidden mt-5 p-3 rounded-xl text-xs font-medium flex items-center gap-2 shadow-sm border ${className}`;
    statusMobile.innerHTML = innerContent;
  }
  lucide.createIcons();
}

function getBatchSize(){
  const elInput = document.getElementById("batchSize");
  const v = elInput ? parseInt(elInput.value,10) : 50;
  return Number.isFinite(v) && v > 0 ? v : 50;
}

const el = {
  src: document.getElementById("sourceText"),
  tableWrap: document.getElementById("tableWrap"),
  table: document.getElementById("resultTable"),
  theadRow: document.querySelector("#resultTable thead tr"),
  tbody: document.querySelector("#resultTable tbody"),
  runBtn: document.getElementById("runBtn"),
  copyBtn: document.getElementById("copyBtn"),
  dlBtn: document.getElementById("dlBtn"),
  toast: document.getElementById("toast"),
  toastMsg: document.getElementById("toastMsg")
};

const _userKeyInput = document.getElementById("userApiKey");
if (_userKeyInput) {
  _userKeyInput.value = localStorage.getItem("apicore_user_key") || "";
  _userKeyInput.addEventListener("input", () => {
    localStorage.setItem("apicore_user_key", _userKeyInput.value);
  });
}

// æ‹–æ‹½æ’åºé€»è¾‘
const list = document.getElementById('headerList');
let dragItem = null;
list.addEventListener('dragstart', e => {
  dragItem = e.target.closest('li');
  if(dragItem) dragItem.classList.add('dragging');
});
list.addEventListener('dragend', e => {
  if(e.target.closest('li')) e.target.closest('li').classList.remove('dragging');
  dragItem = null;
});
list.addEventListener('dragover', e => {
  e.preventDefault();
  const target = e.target.closest('li');
  if (target && dragItem && target !== dragItem) {
    const rect = target.getBoundingClientRect();
    const next = (e.clientX - rect.left) / (rect.right - rect.left) > 0.5;
    list.insertBefore(dragItem, next ? target.nextSibling : target);
  }
});
function getHeaderOrder() {
  return Array.from(list.querySelectorAll('li')).map(li => li.dataset.code);
}

function showToast(msg){
  el.toastMsg.textContent = msg;
  el.toast.classList.remove("opacity-0", "translate-y-[-20px]");
  setTimeout(()=> el.toast.classList.add("opacity-0", "translate-y-[-20px]"), 2000);
}

function sanitizeKeepBr(html){
  return html.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi, "");
}

function splitLines(s){
  return s.split(/\r?\n/).filter(line => line.trim().length>0);
}

function parseTSV(tsv){
  tsv = tsv.replace(/^```[\s\S]*?\n/,"").replace(/```$/,"").trim();
  const lines = tsv.split(/\r?\n/);
  return lines.map(line => line.split("\t"));
}

function renderTable(rows, inputLineCount){
  const header = rows[0] || [];
  el.theadRow.innerHTML = "";
  header.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    th.className = "px-6 py-4 bg-white/80 sticky top-0 font-bold text-slate-600 border-b border-slate-200 z-10";
    el.theadRow.appendChild(th);
  });

  el.tbody.innerHTML = "";
  const dataRows = rows.slice(1);
  let missingCount = 0;
  dataRows.forEach(cols => {
    const tr = document.createElement("tr");
    tr.className = "hover:bg-purple-50/30 transition-colors group";
    header.forEach((_, i) => {
      const td = document.createElement("td");
      const val = (cols[i] ?? "").trim();
      td.className = "px-6 py-4 border-b border-slate-200/50 group-last:border-none align-top leading-relaxed text-slate-700";
      
      if (!val) { 
        td.classList.add("bg-red-50/60", "text-red-600"); 
        missingCount++; 
      }
      td.innerHTML = sanitizeKeepBr(val);
      tr.appendChild(td);
    });
    el.tbody.appendChild(tr);
  });

  resultContainer.classList.remove('hidden');
  el.tableWrap.style.display = "block";
  
  const outLines = dataRows.length;
  let statusHTML = "";
  let statusClass = "";

  if (outLines !== inputLineCount) {
    statusClass = "bg-red-50/60 text-red-600 border-red-100/50";
    statusHTML = `<i data-lucide="alert-triangle" class="w-4 h-4"></i> <span>è¡Œæ•°å¼‚å¸¸: ${inputLineCount}â†’${outLines}</span>`;
  } else if (missingCount > 0) {
    statusClass = "bg-orange-50/60 text-orange-600 border-orange-100/50";
    statusHTML = `<i data-lucide="alert-circle" class="w-4 h-4"></i> <span>${missingCount} ç©ºæ ¼</span>`;
  } else {
    statusClass = "bg-green-50/60 text-green-600 border-green-100/50";
    statusHTML = `<i data-lucide="check-circle" class="w-4 h-4"></i> <span>å®Œæˆ</span>`;
  }
  updateStatus(statusHTML, statusClass);
}

async function translateAndRender(){
  const input = el.src.value.trim();
  const examples = document.getElementById("bestExamples").value.trim();
  const customPrompt = (document.getElementById("customPrompt")?.value || "").trim();
  const inputLines = splitLines(input);
  if (!input){ showToast("è¯·è¾“å…¥è‹±æ–‡æ–‡æœ¬"); return; }

  const BATCH_SIZE = getBatchSize();
  
  updateStatus(`<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> <span>å‡†å¤‡ä¸­...</span>`, "bg-blue-50/60 text-blue-600 border-blue-100/50");

  el.tableWrap.style.display = "none"; 
  el.runBtn.disabled = true;
  el.runBtn.classList.add("opacity-70", "cursor-not-allowed");

  try {
    const total = inputLines.length; let offset = 0; let combinedTSV = "";
    const totalBatches = Math.ceil(total / BATCH_SIZE);
    for (let i=1;i<=totalBatches;i++){
      updateStatus(`<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> <span>æ‰¹æ¬¡ ${i}/${totalBatches}</span>`, "bg-purple-50/60 text-purple-600 border-purple-100/50");
      
      const res = await fetch(API,{
        method:"POST",headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          text:inputLines.join("\n"),examples,customPrompt,
          headerOrder:getHeaderOrder(),offset,batchSize:BATCH_SIZE,
          userApiKey:(document.getElementById("userApiKey")?.value||"").trim()
        })
      });
      if(!res.ok) throw new Error("è¯·æ±‚å¤±è´¥");
      const data=await res.json();
      if(data.error){throw new Error(data.error.message||"åç«¯é”™è¯¯");}
      combinedTSV += (combinedTSV?"\n":"")+(data.table||"").trim();
      offset += BATCH_SIZE; await sleep(1500);
    }
    const rows=parseTSV(combinedTSV);
    renderTable(rows,inputLines.length);
    el.tableWrap.dataset.tsv=rows.map(r=>r.join("\t")).join("\n");
  }catch(e){
    updateStatus(`<i data-lucide="x-circle" class="w-4 h-4"></i> <span>å¤±è´¥</span>`, "bg-red-50/60 text-red-600 border-red-100/50");
    showToast(e.message);
  }finally{
    el.runBtn.disabled=false;
    el.runBtn.classList.remove("opacity-70", "cursor-not-allowed");
  }
}

async function robustCopy(text){
  if(navigator.clipboard&&navigator.clipboard.writeText){await navigator.clipboard.writeText(text);return;}
  const ta=document.createElement("textarea");
  ta.value=text;ta.style.position="absolute";ta.style.left="-9999px";document.body.appendChild(ta);
  ta.select();document.execCommand("copy");document.body.removeChild(ta);
}

el.runBtn.addEventListener("click",translateAndRender);
el.copyBtn.addEventListener("click",async()=>{
  const tsv=el.tableWrap.dataset.tsv||"";const lines=tsv.split(/\r?\n/);
  const noHeader=lines.length>1?lines.slice(1).join("\n"):"";
  if(!noHeader.trim()){showToast("æ²¡æœ‰å¯å¤åˆ¶çš„ TSV");return;}
  await robustCopy(noHeader);showToast("å·²å¤åˆ¶ TSV");
});
el.dlBtn.addEventListener("click",()=>{
  const tsv=el.tableWrap.dataset.tsv||"";if(!tsv.trim()){showToast("æ²¡æœ‰å¯ä¸‹è½½çš„ TSV");return;}
  const blob=new Blob([tsv],{type:"text/tab-separated-values;charset=utf-8"});
  const url=URL.createObjectURL(blob);const a=document.createElement("a");
  a.href=url;a.download="translations.tsv";a.click();URL.revokeObjectURL(url);
});

// é¢„è®¾å¡«å……é€»è¾‘
const presetSelect = document.getElementById("presetPrompt");
const customPromptArea = document.getElementById("customPrompt");

if (presetSelect && customPromptArea) {
  const presets = {
    music: `æ­¤æ¬¡ä»»åŠ¡æ˜¯è¿›è¡ŒAIéŸ³ä¹SAASç½‘ç«™çš„æ–‡æ¡ˆç¿»è¯‘ï¼Œéœ€è¦å°†ä¸ AI éŸ³ä¹åˆ›ä½œã€æ··éŸ³ã€æ¯å¸¦ã€æ­Œè¯æˆ–éŸ³é¢‘å·¥å…·ç›¸å…³çš„æ–‡æœ¬ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€ï¼Œä½¿å…¶è‡ªç„¶ã€æœ¬åœ°åŒ–ã€ç¬¦åˆéŸ³ä¹è¡Œä¸šæœ¯è¯­åŠ SEO è¡¨è¾¾ï¼Œé€‚ç”¨äºå…¨çƒéŸ³ä¹ç”Ÿæˆå¹³å°ã€éŸ³é¢‘å·¥å…·ç½‘ç«™å’Œå¤šè¯­è¨€äº§å“é¡µé¢ã€‚\n\nè§„åˆ™ï¼š\n- ä¿ç•™åŸæ–‡æ ¼å¼ä¸æ’ç‰ˆï¼Œä¸å¢åˆ å†…å®¹ã€‚\n- JSONæ ¼å¼çš„æ•°æ®è¦ä¿ç•™åŸæœ‰ç»“æ„ï¼Œä¸èƒ½å½±å“å¼€å‘ï¼ŒåŒ…æ‹¬å…¨éƒ¨çš„[]{}ï¼Œä¿ç•™è‹±æ–‡çš„é€—å·,è‹±æ–‡çš„å¼•å·""ï¼Œjsonä¸­çš„keyä¿ç•™ä¸ç¿»è¯‘ç­‰ç­‰\n- ç¿»è¯‘éœ€å…¼é¡¾éŸ³ä¹åˆ¶ä½œã€AI åˆ›ä½œä¸éŸ³é¢‘å·¥ç¨‹é¢†åŸŸçš„ä¸“ä¸šå‡†ç¡®æ€§ã€‚\n- äº§å“åæˆ–å“ç‰Œåä¿æŒåŸæ–‡ï¼ˆå¦‚ MusicCreator AIã€Sunoã€OpenMusicï¼‰ã€‚\n- ç¼ºå°‘åˆé€‚è¯‘è¯æ—¶å¯ä¿ç•™è‹±æ–‡åŸæ–‡ï¼Œä½†éœ€ç¬¦åˆç›®æ ‡è¯­è¨€è¯­åºã€‚\n- è¯­è¨€é£æ ¼ï¼š\n- ä¸“ä¸šã€è‡ªç„¶ã€é¢å‘åˆ›ä½œè€…ã€åˆ¶ä½œäººã€è‰ºæœ¯å®¶åŠæ™®é€šç”¨æˆ·ã€‚\n- ç”¨è¯åº”æ¸…æ™°ã€ç®€æ´ï¼Œé¿å…è¿‡åº¦è¥é”€æˆ–æœºæ¢°ç›´è¯‘ã€‚\n- å¯¹äºåŸè‹±æ–‡ä¸­çš„è¿è¯ç¬¦ï¼Œéœ€è¦åœ¨ä¸åŒç›®æ ‡è¯­è¨€ä¸‹ç»“åˆå¥æ„ï¼Œè¯­å¢ƒï¼Œè°ƒæ•´å¥½è¡¨è¾¾çš„è¯­åº\n- åœ¨æè¿°åŠŸèƒ½æˆ–æµç¨‹æ—¶ï¼Œåº”é‡‡ç”¨éŸ³ä¹äººå¸¸ç”¨è¡¨è¾¾æ–¹å¼ã€‚\n- è‹¥æ¶‰åŠ SEO æè¿°ï¼Œä¼˜å…ˆä½¿ç”¨è¡Œä¸šä¸­æœç´¢é‡è¾ƒé«˜çš„è‡ªç„¶è¯´æ³•ã€‚\n\nè¯´æ˜ï¼š\n- ä¿ç•™æ‰€æœ‰éŸ³é¢‘å‚æ•°ã€ç¬¦å·ã€å ä½ç¬¦åŠ HTML æ ‡ç­¾ã€‚\n- ç¿»è¯‘éŸ³ä¹åŠŸèƒ½æœ¯è¯­æ—¶éµå¾ªä¸“ä¸šæ ‡å‡†ï¼Œå¦‚ EQã€DAWã€compressorã€vocalã€drum loopã€BPM ç­‰ã€‚\n- è‹¥å‡ºç°æµæ´¾æˆ–é£æ ¼è¯æ±‡ï¼ˆå¦‚ lofiã€phonkã€EDMã€jazzï¼‰ï¼Œä¿æŒåŸæ–‡æ‹¼å†™ã€‚\n- ä¿ç•™éŸ³ä¹å“ç‰Œä¸äº§å“åï¼Œä¸è¿›è¡Œç¿»è¯‘æˆ–æ”¹å†™ã€‚\n- è¯­æ°”åº”ç¬¦åˆéŸ³ä¹å¹³å°é£æ ¼ï¼šåˆ›æ„ã€è‡ªç”±ã€é¼“åŠ±è¡¨è¾¾ã€å…¼å…·ä¸“ä¸šåº¦ã€‚`,
    coloring: `æ­¤æ¬¡ä»»åŠ¡æ˜¯å°†ä¸å¡«è‰²é¡µç›¸å…³çš„æç¤ºè¯ã€æè¿°æˆ–å„¿ç«¥å‹å¥½å‹å›¾åƒè¯´æ˜ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€ï¼Œä½¿å…¶è‡ªç„¶ã€æœ¬åœ°åŒ–ã€å…·è§†è§‰æè¿°æ€§ï¼Œé€‚ç”¨äºå…¨çƒå¡«è‰²é¡µç½‘ç«™ã€å›¾åƒç”Ÿæˆæ¨¡å‹åŠå¤šè¯­è¨€å•†å“é¡µé¢ã€‚\n\nè§„åˆ™ï¼š\nä¿ç•™åŸæ–‡çš„æ ¼å¼ä¸æ’ç‰ˆï¼Œä¸å¢åˆ å†…å®¹ã€‚\nä¿ç•™æ‰€æœ‰æŠ€æœ¯è¯æ±‡ï¼ˆå¦‚ outline onlyã€ratio 2:3ã€no shadowã€black and white ç­‰ï¼‰ã€‚\nåŸå§‹çš„è§†è§‰ç»“æ„è¯´æ˜å¿…é¡»å®Œæ•´ä¿ç•™ã€‚\näººç‰©ã€è§’è‰²æˆ– IP åç§°ä½¿ç”¨å„è¯­è¨€ä¸­æœ€å¸¸ç”¨ã€å®˜æ–¹æˆ–å¹¿ä¸ºäººçŸ¥çš„åç§°ï¼Œé¿å…ç›´è¯‘æˆ–éŸ³è¯‘ã€‚\nå½“ç›®æ ‡è¯­è¨€ä¸­ç¼ºå°‘å¯¹åº”æœ¯è¯­æ—¶ï¼Œå¯ä¿ç•™è‹±æ–‡åŸæ–‡ã€‚\n\nè¯­è¨€é£æ ¼ï¼š\næ¸©å’Œã€æœ‰æƒ³è±¡åŠ›ã€å…·è§†è§‰æ„Ÿã€‚\né¢å‘å„¿ç«¥ã€å®¶é•¿æˆ–åˆ›ä½œè€…ã€‚\nè‹¥ä¸º AI å›¾åƒæç¤ºï¼Œåº”ç®€æ´ã€æ¸…æ™°ã€‚\né¿å…ç”Ÿç¡¬ç›´è¯‘æˆ–æœºæ¢°è¡¨è¾¾ã€‚\n\nç¿»è¯‘æµç¨‹ï¼š\nâ‘  ç›´è¯‘ï¼ˆLiteral Translationï¼‰ï¼šé€å­—é€å¥ç¿»è¯‘ï¼Œä¿ç•™ç»“æ„ã€æŠ€æœ¯è¯ã€æ’ç‰ˆã€‚\nâ‘¡ è¯„ä¼°ä¸åæ€ï¼ˆEvaluation and Reflectionï¼‰ï¼šç®€è¦è¯´æ˜ç›´è¯‘ä¸­çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ä¸è‡ªç„¶è¡¨è¾¾ã€è§†è§‰è¯­ä¹‰æ˜¯å¦å‡†ç¡®ã€æŠ€æœ¯æè¿°æ˜¯å¦æ¸…æ™°ã€‚\nâ‘¢ æœ¬åœ°åŒ–è¯‘æ–‡ï¼ˆFree Translationï¼‰ï¼šåŸºäºåæ€é‡æ–°ç¿»è¯‘ï¼Œä½¿è¯­æ°”è‡ªç„¶ã€ç”ŸåŠ¨ã€æ–‡åŒ–å¥‘åˆï¼ŒåŒæ—¶ä¿æŒè§†è§‰ä¸æŠ€æœ¯å‡†ç¡®æ€§ã€‚\n\nè¯´æ˜ï¼š\nä¿ç•™è§’è‰²åã€æ–‡åŒ–åè¯ã€å›¾åƒç‰¹å¾ã€‚\nè‹¥æ–‡æœ¬æè¿°åœºæ™¯ï¼Œåº”å…·ç”»é¢æ„Ÿä¸æ•…äº‹æ€§ã€‚\nå¯¹äºçŸ¥åè§’è‰²ï¼ˆå¦‚ Spidermanã€Elsaã€Hello Kittyï¼‰ï¼Œä½¿ç”¨å½“åœ°å¸¸ç”¨æˆ–å®˜æ–¹åç§°ã€‚\nè‹¥ä¸ç¡®å®šï¼Œé‡‡ç”¨è¯¥è¯­è¨€ä¸­æœç´¢é‡æœ€é«˜çš„ç‰ˆæœ¬ï¼Œä¸å¯éšæ„éŸ³è¯‘ã€‚`,
    tattoo:`æ­¤æ¬¡ä»»åŠ¡æ˜¯å°†ä¸AIçº¹èº«ç›¸å…³çš„æç¤ºè¯ã€æè¿°æˆ–å›¾åƒè¯´æ˜ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€ï¼Œä½¿å…¶è‡ªç„¶ã€æœ¬åœ°åŒ–ã€å…·è§†è§‰æè¿°æ€§ï¼Œé€‚ç”¨äºå…¨çƒçº¹èº«ç½‘ç«™ã€çº¹èº«å›¾ç”Ÿæˆæ¨¡å‹åŠå¤šè¯­è¨€å•†å“é¡µé¢ã€‚

è§„åˆ™ï¼š
ä¿ç•™åŸæ–‡çš„æ ¼å¼ä¸æ’ç‰ˆï¼Œä¸å¢åˆ å†…å®¹ã€‚
ä¿ç•™æ‰€æœ‰æŠ€æœ¯è¯æ±‡ï¼ˆå¦‚ outline onlyã€ratio 2:3ã€no shadowã€black and white ç­‰ï¼‰ã€‚
åŸå§‹çš„è§†è§‰ç»“æ„è¯´æ˜å¿…é¡»å®Œæ•´ä¿ç•™ã€‚
å½“ç›®æ ‡è¯­è¨€ä¸­ç¼ºå°‘å¯¹åº”æœ¯è¯­æ—¶ï¼Œå¯ä¿ç•™è‹±æ–‡åŸæ–‡ã€‚

è¯­è¨€é£æ ¼ï¼š
æœ‰æƒ³è±¡åŠ›ã€å…·è§†è§‰æ„Ÿã€‚
é¢å‘çº¹èº«çˆ±å¥½è€…ï¼Œçº¹èº«å¸ˆ
è‹¥ä¸º AI å›¾åƒæç¤ºï¼Œåº”ç®€æ´ã€æ¸…æ™°ã€‚
é¿å…ç”Ÿç¡¬ç›´è¯‘æˆ–æœºæ¢°è¡¨è¾¾ã€‚

ç¿»è¯‘æµç¨‹ï¼š
â‘  ç›´è¯‘ï¼ˆLiteral Translationï¼‰ï¼šé€å­—é€å¥ç¿»è¯‘ï¼Œä¿ç•™ç»“æ„ã€æŠ€æœ¯è¯ã€æ’ç‰ˆã€‚
â‘¡ è¯„ä¼°ä¸åæ€ï¼ˆEvaluation and Reflectionï¼‰ï¼šç®€è¦è¯´æ˜ç›´è¯‘ä¸­çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ä¸è‡ªç„¶è¡¨è¾¾ã€è§†è§‰è¯­ä¹‰æ˜¯å¦å‡†ç¡®ã€æŠ€æœ¯æè¿°æ˜¯å¦æ¸…æ™°ã€‚
â‘¢ æœ¬åœ°åŒ–è¯‘æ–‡ï¼ˆFree Translationï¼‰ï¼šåŸºäºåæ€é‡æ–°ç¿»è¯‘ï¼Œä½¿è¯­æ°”è‡ªç„¶ã€ç”ŸåŠ¨ã€æ–‡åŒ–å¥‘åˆï¼ŒåŒæ—¶ä¿æŒè§†è§‰ä¸æŠ€æœ¯å‡†ç¡®æ€§ã€‚

è¯´æ˜ï¼š
ä¿ç•™è§’è‰²åã€æ–‡åŒ–åè¯ã€å›¾åƒç‰¹å¾ã€‚
è‹¥æ–‡æœ¬æè¿°åœºæ™¯ï¼Œåº”å…·ç”»é¢æ„Ÿä¸æ•…äº‹æ€§ã€‚
è‹¥ä¸ç¡®å®šï¼Œé‡‡ç”¨è¯¥è¯­è¨€ä¸­æœç´¢é‡æœ€é«˜çš„ç‰ˆæœ¬ï¼Œä¸å¯éšæ„éŸ³è¯‘ã€‚`
  };
  // ä¸ºäº†èŠ‚çœ token ç•¥å»éƒ¨åˆ†æ–‡æœ¬ï¼Œå®é™…ä»£ç è¯·ä¿ç•™åŸæœ‰çš„é•¿æ–‡æœ¬
  presetSelect.addEventListener("change", () => {
    // è¿™é‡Œä½¿ç”¨äº†ç®€åŒ–çš„é€»è¾‘ï¼Œå®é™…ä½¿ç”¨æ—¶ä½ å¯ä»¥æŠŠä¸Šé¢å¾ˆé•¿çš„ presets æ–‡æœ¬æ”¾å›å»
    const v = presetSelect.value;
    // æ¢å¤ä½ åŸå§‹çš„é•¿æ–‡æœ¬é€»è¾‘
    if (v === 'music') customPromptArea.value = presets.music;
    else if (v === 'coloring') customPromptArea.value = presets.coloring; 
    else customPromptArea.value = "";
  });
}

const examplePreset = document.getElementById("examplePreset");
const bestExamplesArea = document.getElementById("bestExamples");
if (examplePreset && bestExamplesArea) {
    const examplePresets = {
    music: `è‹±è¯­	zh	ja	de	pt	es	fr	ko	vi\nbeats	ä¼´å¥	æ‰“ã¡è¾¼ã¿ éŸ³æ¥½	beats	batidas	ritmos	Beats	beats	nhá»‹p Ä‘iá»‡u\nFREE	å…è´¹	ç„¡æ–™	Kostenlos	GrÃ¡tis	Gratis	Gratuit	ë¬´ë£Œ	miá»…n phÃ­\nkaraoke	å¡æ‹‰OK	ã‚«ãƒ©ã‚ªã‚±ã‚¢ãƒ—ãƒªç„¡æ–™	Karaoke	karaokÃª	karaoke	KaraokÃ©	ê°€ë¼ì˜¤ì¼€	hÃ¡t karaoke\nOnline	åœ¨çº¿	ã‚ªãƒ³ãƒ©ã‚¤ãƒ³	Online	Na rede	En lÃ­nea	En Ligne	ì˜¨ë¼ì¸	trá»±c tuyáº¿n\nLofi	ä½ä¿çœŸ	Lofi	Lo-fi	Lofi	Lofi	Lofi	Lofi	Lofi\nAI Music Generator	AIéŸ³ä¹ç”Ÿæˆå™¨	éŸ³æ¥½ç”Ÿæˆ AI	KI Musik Generator	Gerador de MÃºsica IA	Generador de MÃºsica IA	IA Musique Gratuite	AI ë…¸ë˜ ë§Œë“¤ê¸°	\nAI Voice	AIå£°éŸ³	AIæ­Œå£°	KI Stimme	Voz artificial	Voz de IA	IA Voix	AI ë³´ì´ìŠ¤	giá»ng AI\nsoundtrack	åŸå£°éŸ³ä¹	ã‚µãƒ³ãƒˆãƒ©	Soundtrack	Trilha Sonora	banda sonora	Bande Sonore	OST	nháº¡c phim\nAI Music	AIéŸ³ä¹	AI éŸ³æ¥½	KI Musik	MÃºsica IA	MÃºsica IA	IA Musique	AI ë…¸ë˜	AI hÃ¡t\nBPM Tapper	BPMèŠ‚å¥ç‚¹å‡»å™¨	BPMã‚«ã‚¦ãƒ³ã‚¿ãƒ¼	BPM Messer	Tempo tapper	Calculadora de BPM	DÃ©tecteur De BPM	BPM ì¸¡ì •	tempo tap\nAI Lyrics Generator	AIæ­Œè¯ç”Ÿæˆå™¨	æ­Œè© ä½œã‚‹ ã‚µã‚¤ãƒˆ	KI-Textgenerator	Gerador de Letras IA	Generador de Letras IA	GÃ©nÃ©rateur De Parole IA	ë© ê°€ì‚¬ ì“°ëŠ” ì‚¬ì´íŠ¸	táº¡o lá»i bÃ i hÃ¡t AI\nremove vocals	å»äººå£°	ãƒœãƒ¼ã‚«ãƒ«é™¤å»	Gesang entfernen	Removedor de vocal	Quitar Vocales		ë³´ì»¬ë¦¬ë¬´ë²„	tÃ¡ch giá»ng\nAI Vocal Remover	AIäººå£°ç§»é™¤å·¥å…·	ãƒœãƒ¼ã‚«ãƒ«æŠ½å‡º	KI Vocal Remover	Removedor de Vocais 	Eliminador de Voz IA	SÃ©parateur Voix Musique	ë³´ì»¬ ë¦¬ë¬´ë²„	tÃ¡ch giá»ng\nEffortlessly	è½»æ¾åœ°/æ¯«ä¸è´¹åŠ›	ç°¡å˜ã«	MÃ¼helos	Sem esforÃ§o	sin esfuerzo	Facilement	ë¬´ë£Œ	dá»… dÃ ng\nMusic Creator	éŸ³ä¹åˆ›ä½œè€…	éŸ³æ¥½ä½œæˆ	Musik Erstellen	Criador de MÃºsica	Creador de MÃºsica	Compositeur De Musique	ì‘ê³¡ í”„ë¡œê·¸ë¨	táº¡o nháº¡c\nAI Rap Generator	AIè¯´å”±ç”Ÿæˆå™¨	AIãƒ©ãƒƒãƒ—ç”Ÿæˆ	KI Rap Generator	Gerador de rap de IA	Generador de rap	GÃ©nÃ©rateur de rap IA	AI ë© ìƒì„±ê¸°	táº¡o nháº¡c rap AI\nAI Stem Splitter	AIéŸ³è½¨åˆ†ç¦»	éŸ³å£°åˆ†é›¢	KI Stem Splitter	Divisor de hastes AI	Separador de Pistas IA	SÃ©parateur De Piste Audio	ìŒì› ë¶„ë¦¬	tÃ¡ch nháº¡c vÃ  giá»ng\nVoice Cloning	å£°éŸ³å…‹éš†	AI ãƒœã‚¤ã‚¹	Klonen von Gesangsstimmen	clonar voz	ClonaciÃ³n de Voz	Clonage Voix IA	AI ëª©ì†Œë¦¬ ë§Œë“¤ê¸°	táº¡o giá»ng nÃ³i AI\nMIDI files	MIDIæ–‡ä»¶	MIDIãƒ•ã‚¡ã‚¤ãƒ«	MIDI Dateien	Arquivos MIDI	archivos MIDI	Fichiers MIDI	ë¯¸ë”” íŒŒì¼ 	tá»‡p MIDI\nRoyalty Free	å…ç‰ˆç¨	ãƒ­ã‚¤ãƒ¤ãƒªãƒ†ã‚£ãƒ•ãƒªãƒ¼	Lizenzfreie	Sem Direitos Autorais	libre de derechos	Libre De Droits	ì €ì‘ê¶Œ ì—†ëŠ”	KhÃ´ng báº£n quyá»n\nAI Song Cover	AIç¿»å”±	AI ã‚«ãƒãƒ¼	KI Song Cover	criar capas IA	Portada de la canciÃ³n AI	Cover IA	AI ë…¸ë˜ ì»¤ë²„	bÃ i hÃ¡t cover AI\nMIDI Editor	MIDIç¼–è¾‘å™¨	MIDIã‚¨ãƒ‡ã‚£ã‚¿	MIDI Editor	Editor MIDI	Editor MIDI	Ã‰diteur MIDI	ë¯¸ë”” ì—ë””í„°	trÃ¬nh chá»‰nh sá»­a MIDI\nMIDI converter	MIDIè½¬æ¢å™¨	midi å¤‰æ›	MIDI Konverter	Conversor de MIDI	convertidor MIDI	Convertisseur MIDI	ë¯¸ë”” ë³€í™˜ê¸°	chuyá»ƒn Ä‘á»•i MIDI\nAI Singing Voice Generator	AIæ­Œå£°ç”Ÿæˆå™¨	AI æ­Œã‚ã›ã‚‹	KI Gesangsstimmen Generator	Gerador de Voz de Canto IA	Generador de voz de canto con IA	GÃ©nÃ©rateur de Voix IA	AI ëª©ì†Œë¦¬ ë§Œë“¤ê¸°	táº¡o giá»ng hÃ¡t AI\nAI Song Cover Generator	AIæ­Œæ›²ç¿»å”±ç”Ÿæˆå™¨	AIã‚«ãƒãƒ¼ ã‚„ã‚Šæ–¹	KI Song Cover Generator	Gerador de Covers de MÃºsicas com IA	Generador de portadas de canciones con IA	GÃ©nÃ©rateur De Cover IA	AI ë…¸ë˜ ì»¤ë²„ ë§Œë“¤ê¸°	táº¡o bÃ i hÃ¡t cover AI\nAI MIDI Generator	AI MIDIç”Ÿæˆå™¨	midi å¤‰æ›	KI MIDI Generator	Gerador MIDI AI	Generador de MIDI con IA	GÃ©nÃ©rateur MIDI IA	AI ë¯¸ë”” ìƒì„±	táº¡o MIDI AI\nlyrics to song generator	æ­Œè¯è½¬æ­Œæ›²ç”Ÿæˆå™¨	æ­Œè© ã‹ã‚‰ ä½œæ›²	KI Songtext erstellen	letras para gerador de mÃºsicas	letras a cancion	GÃ©nÃ©rateur De Musique Par Paroles	ê°€ì‚¬ ìŒì•… ìƒì„±ê¸°	cÃ´ng cá»¥ táº¡o nháº¡c tá»« lá»i bÃ i hÃ¡t AI\nAI Instrumental Generator	AIä¼´å¥ç”Ÿæˆå™¨	bgm ä½œã‚‹ ã‚µã‚¤ãƒˆ	 KI Hintergrundmusik Generator	Gerador Instrumental de IA	Generador de Instrumentales con IA	GÃ©nÃ©rateur D'instrumental IA	AI ì•…ê¸° ìƒì„±ê¸°	táº¡o nháº¡c khÃ´ng lá»i AI\nText to Music	æ–‡æœ¬ç”ŸæˆéŸ³ä¹	æ­Œè©ã‚’å…¥ã‚Œã‚‹ã ã‘ã§ä½œæ›² ã‚µã‚¤ãƒˆ	Text zu Musik	Texto para MÃºsica	Texto a mÃºsica	Texte En Musique	í…ìŠ¤íŠ¸ íˆ¬ ìŒì•…	táº¡o nháº¡c tá»« vÄƒn báº£n AI\ncopyright free	ç‰ˆæƒå…è´¹	è‘—ä½œæ¨©ãƒ•ãƒªãƒ¼	Lizenzfrei	Uso Livre	libre de derechos de autor	Musique Sans Droit D'auteur	ì €ì‘ê¶Œ ì—†ëŠ”	KhÃ´ng báº£n quyá»n\nAI Music Mastering	AIéŸ³ä¹æ¯å¸¦å¤„ç†	AIãƒã‚¹ã‚¿ãƒªãƒ³ã‚°	KI-Musik-Mastering	MasterizaÃ§Ã£o musical com IA	MasterizaciÃ³n de MÃºsica con IA	Mastering IA	AI ë§ˆìŠ¤í„°ë§	mastering AI\nMaking AI Music	åˆ¶ä½œAIéŸ³ä¹	AI éŸ³æ¥½ä½œæˆ	KI-Musik erstellen	Fazendo mÃºsica com IA	crear musica con ia	IA Musique	AI ìŒì•… ë§Œë“¤ê¸°	táº¡o nháº¡c\nGenerate AI Music	ç”ŸæˆAIéŸ³ä¹	AI æ›² ä½œæˆ	KI Musik Erstellen	Gerar MÃºsica com IA	crear musica con ia	GÃ©nÃ©rateur De Musique IA	AI ë…¸ë˜ ë§Œë“¤ê¸°	AI nháº¡c táº¡o\nMusic Generation	éŸ³ä¹ç”Ÿæˆ	ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³	Musikproduktion	GeraÃ§Ã£o de MÃºsica	CreaciÃ³n de MÃºsica con IA	IA Creation Musique	ìŒì•… ìƒì„±	lÃ m nháº¡c\nAI Editing Tools	AIç¼–è¾‘å·¥å…·	éŸ³æ¥½ç·¨é›†ã‚¢ãƒ—ãƒª		Ferramentas de ediÃ§Ã£o de IA	Herramientas de EdiciÃ³n con IA	Editeur IA	AI í¸ì§‘ê¸°	cÃ´ng cá»¥ chá»‰nh sá»­a AI\nMUSIC CREATION TOOLS	éŸ³ä¹åˆ›ä½œå·¥å…·	éŸ³æ¥½ä½œæˆã‚¢ãƒ—ãƒª	MUSIKERSTELLUNGSTOOLS ENTDECKEN	FERRAMENTAS DE CRIAÃ‡ÃƒO MUSICAL	Herramientas de CreaciÃ³n Musical	Logiciel Musique	ì‘ê³¡ í”„ë¡œê·¸ë¨	phÃ²ng thu\nlyrics to song maker	æ­Œè¯è½¬æ­Œæ›²åˆ¶ä½œå·¥å…·	æ­Œè©ã‚’å…¥ã‚Œã‚‹ã ã‘ã§ä½œæ›² ã‚µã‚¤ãƒˆ	Songtext zu Musik	letras para criador de mÃºsicas	letras a cancion	Ã©nÃ©rateur de chansons Ã  partir de paroles	ê°€ì‚¬ë¥¼ ìŒì•…ìœ¼ë¡œ ë³€í™˜	cÃ´ng cá»¥ táº¡o nháº¡c tá»« lá»i bÃ i hÃ¡t AI\nLyric To Music	æ­Œè¯å˜éŸ³ä¹	æ­Œè© ã‹ã‚‰ ä½œæ›²	Songtext zu Musik	Letra para MÃºsica	Letra a MÃºsica	Paroles En Musique	ê°€ì‚¬ ìŒì•… ë³€í™˜	táº¡o nháº¡c tá»« lá»i bÃ i hÃ¡t AI\nPhoto to Music	ç…§ç‰‡è½¬éŸ³ä¹	å†™çœŸã«éŸ³æ¥½ã‚’ã¤ã‘ã‚‹	Foto zu Musik	Foto para MÃºsica	Foto a MÃºsica	Photo En Musique	ì´ë¯¸ì§€ íˆ¬ ìŒì•…	táº¡o nháº¡c tá»« áº£nh AI\nAI Text to Music Generator	AIæ–‡ç”Ÿæ›²	AI ä½œè© ä½œæ›²	KI Text zu Musik Generator	Gerador de MÃºsica IA a partir de Texto	Generador de MÃºsica IA a partir de Texto	IA Qui Chante Un Texte	AI ìŒì•… ë§Œë“¤ê¸°	táº¡o nháº¡c tá»« vÄƒn báº£n AI\nAudio Separation	éŸ³é¢‘åˆ†ç¦»	éŸ³å£°åˆ†é›¢	Audiotrennung	SeparaÃ§Ã£o de Ãudio	SeparaciÃ³n de Audio	SÃ©parateur Voix Musique	ìŒì› ë¶„ë¦¬	tÃ¡ch nháº¡c vÃ  giá»ng\npersonal album	ä¸ªäººä¸“è¾‘	ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¢ãƒ«ãƒãƒ 	privates Album	Ã¡lbum pessoal	Ã¡lbum personal	Album Personnel	ì•¨ë²”	album cÃ¡ nhÃ¢n\nAI MUSIC PLATFORM	AIéŸ³ä¹å¹³å°	AI éŸ³æ¥½	KI Musikplattform	Plataforma de MÃºsica com IA	PLATAFORMA DE MÃšSICA CON IA	Plateforme Musicale IA	AI ìŒì•…	ná»n táº£ng nháº¡c\nproduction-ready	å¯ç›´æ¥ç”¨äºåˆ¶ä½œ	å³æˆ¦åŠ›	produktionsreif	pronto para produÃ§Ã£o	listas para la producciÃ³n	PrÃªt Ã€ L'emploi	ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥	Sáºµn sÃ ng Ä‘á»ƒ sá»­ dá»¥ng\nmake bgm	åˆ¶ä½œèƒŒæ™¯éŸ³ä¹	bgm ä½œã‚‹		criar fundo de musica	hacer bgm	CrÃ©er Une Musique De Fond	bgm ë§Œë“¤ê¸°	táº¡o nháº¡c ná»n\nAI song maker	AIæ­Œæ›²åˆ¶ä½œå™¨	AIä½œæ›²ãƒ„ãƒ¼ãƒ«	KI-Song-Maker	Criador de canÃ§Ãµes com IA	creador de canciones con IA	CrÃ©er De La Musique Avec L'IA	AI ë…¸ë˜ë§Œë“¤ê¸°	táº¡o nháº¡c\nSlowed + Reverb	é™é€Ÿæ··å“	ã‚¹ãƒ­ãƒ¼+ãƒªãƒãƒ¼ãƒ–	Verlangsamt und Hall	Desacelerado + Reverb	Ralentizado + Reverb	Ralenti + RÃ©verbÃ©ration	ëŠë ¤ì§ + ë¦¬ë²„ë¸Œ	Cháº­m + Reverb\nNoise Generator	å™ªéŸ³ç”Ÿæˆå™¨	ãƒã‚¤ã‚ºã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼	Rauschgenerator	Gerador de ruÃ­do	Generador de ruido	GÃ©nÃ©rateur de bruit	ë…¸ì´ì¦ˆ ìƒì„±ê¸°	TrÃ¬nh táº¡o tiáº¿ng á»“n\nChord Progression	å’Œå¼¦èµ°å‘	ã‚³ãƒ¼ãƒ‰é€²è¡Œ	Akkordfolge	ProgressÃ£o de Acordes	ProgresiÃ³n de Acordes	Progression d'accords	ì½”ë“œ ì§„í–‰	Chuá»—i há»£p Ã¢m\n8-Bit	8ä½å¤å¤éŸ³è‰²	8ãƒ“ãƒƒãƒˆ	8 Bit	8 bits	8 bits	8 bits	8ë¹„íŠ¸	8-bit\nAI Background Music Generator	AIèƒŒæ™¯éŸ³ä¹ç”Ÿæˆå™¨	AIèƒŒæ™¯éŸ³æ¥½ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼	KI Hintergrundmusik Generator	Gerador de MÃºsica de Fundo com IA	Generador de MÃºsica de Fondo con IA	GÃ©nÃ©rateur de musique de fond IA	AI ë°°ê²½ ìŒì•… ìƒì„±ê¸°	TrÃ¬nh táº¡o nháº¡c ná»n AI\nLofi Converter	Lofiè½¬æ¢å™¨	ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼	Lo-Fi Konverter	Conversor Lofi	Convertidor Lofi	Convertisseur Lo-fi	ë¡œíŒŒì´ ë³€í™˜ê¸°	Bá»™ chuyá»ƒn Ä‘á»•i Lofi\nAI Music Maker	AIéŸ³ä¹åˆ¶ä½œå™¨	AI éŸ³æ¥½ä½œæˆ	KI Musik Erstellen	Fazedor de MÃºsica IA	Crear Musica Con IA	CrÃ©er De La Musique Avec L'IA	AI ìŒì•… ë§Œë“¤ê¸°	CÃ´ng Cá»¥ Táº¡o Nháº¡c AI\nAI Music Video Generator	AIéŸ³ä¹è§†é¢‘ç”Ÿæˆå™¨	AIãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ãƒ“ãƒ‡ã‚ªç”Ÿæˆ	KI Musikvideo Generator	Gerador de VÃ­deos de MÃºsica IA	Generador de Videos Musicales IA	GÃ©nÃ©rateur de VidÃ©os Musicales IA	AI ë®¤ì§ë¹„ë””ì˜¤ ìƒì„±ê¸°	TrÃ¬nh táº¡o video ca nháº¡c AI`,
    coloring: `å¾…è¡¥å……`
  };
  examplePreset.addEventListener("change", () => {
    const v = examplePreset.value;
    if (v && examplePresets[v]) bestExamplesArea.value = examplePresets[v];
    else bestExamplesArea.value = "";
  });
}

// ç¤ºä¾‹é¢„è§ˆ
const previewBtn = document.getElementById("previewExampleBtn");
const modal = document.getElementById("examplePreviewModal");
const closeBtn = document.getElementById("closePreviewBtn");
const exampleTable = document.getElementById("examplePreviewTable");

function parseTSVToTable(tsvText) {
  const rows = tsvText.trim().split(/\r?\n/).map(r => r.split("\t"));
  const thead = exampleTable.querySelector("thead");
  const tbody = exampleTable.querySelector("tbody");
  thead.innerHTML = ""; tbody.innerHTML = "";
  if (rows.length === 0) return;

  const headerRow = document.createElement("tr");
  rows[0].forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    th.className = "px-6 py-3 bg-white/60 font-bold text-slate-700 border-b border-white/40 sticky top-0 backdrop-blur-sm";
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);

  rows.slice(1).forEach(r => {
    const tr = document.createElement("tr");
    r.forEach(c => {
      const td = document.createElement("td");
      td.textContent = c;
      td.className = "px-6 py-2 border-b border-white/20 text-slate-600";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

if (previewBtn && modal && closeBtn) {
  previewBtn.addEventListener("click", () => {
    const text = document.getElementById("bestExamples").value.trim();
    if (!text) { showToast("æ²¡æœ‰å¯é¢„è§ˆçš„ç¤ºä¾‹å†…å®¹"); return; }
    parseTSVToTable(text);
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  });
  closeBtn.addEventListener("click", () => {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  });
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }
  });
}

const tableBody = document.querySelector("#resultTable tbody");
if (tableBody) {
  tableBody.addEventListener("click", async (e) => {
    const td = e.target.closest("td");
    if (!td) return;
    const text = td.textContent.trim();
    if (!text) return;
    try {
      await navigator.clipboard.writeText(text);
      showToast("å·²å¤åˆ¶");
      td.classList.add("bg-green-100/60");
      setTimeout(() => td.classList.remove("bg-green-100/60"), 500);
    } catch {
      showToast("å¤åˆ¶å¤±è´¥");
    }
  });
}
</script>
</body>
</html>


